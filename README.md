# STAYPOLIO ìŠ¤íƒ€ì¼ ìˆ™ì†Œ ì‚¬ì´íŠ¸ ì›¹êµ¬í˜„ í”„ë¡œì íŠ¸

<p align="center">
  <img src="https://github.com/user-attachments/assets/ca107229-293b-418b-8fb5-d15274705f6f" width="800" alt="ë©”ì¸í™”ë©´" />
</p>


---

<br>

## ëª©ì°¨

- [ê°œìš”]()

- [ê¸°ìˆ  ìŠ¤íƒ]()

- [í”„ë¡œì íŠ¸ ì„¤ê³„](https://github.com/Spring-team-Project2025/stay_folio_main)

- [í•µì‹¬ ê¸°ëŠ¥]()

- [ì£¼ìš”ê¸°ëŠ¥ ì‹¤í–‰í™”ë©´]()

<br>

---

<br>

## ğŸ“Œ í”„ë¡œì íŠ¸ ê°œìš”

StayFolio ìŠ¤íƒ€ì¼ì˜ **ìˆ™ë°• ì˜ˆì•½ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜**ìœ¼ë¡œ,
**Spring MVC (ë ˆê±°ì‹œ), MyBatis, JSP** ê¸°ë°˜ìœ¼ë¡œ ê°œë°œë˜ì—ˆìœ¼ë©° **Oracle Cloud DBì™€ AWS S3ë¥¼ ì—°ë™**í–ˆìŠµë‹ˆë‹¤.
ìˆ™ì†Œ ê²€ìƒ‰ë¶€í„° ì˜ˆì•½Â·ê²°ì œê¹Œì§€ ì‹¤ì œ ì„œë¹„ìŠ¤ ê°€ëŠ¥í•œ ìˆ˜ì¤€ì˜ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í–ˆìŠµë‹ˆë‹¤.

ë˜í•œ **Figma, Google Sheetsë¥¼ í™œìš©í•´ ì´ˆê¸° ê¸°íš ë‹¨ê³„ë¶€í„° í™”ë©´ ì„¤ê³„, ë°ì´í„° êµ¬ì¡° ì •ì˜, ì¼ì • ê´€ë¦¬**ê¹Œì§€ ì „ ê³¼ì •ì„ ê²½í—˜í•˜ë©°  
ê¸°íš â†’ ì„¤ê³„ â†’ ê°œë°œ â†’ í…ŒìŠ¤íŠ¸ â†’ ë°°í¬ë¡œ ì´ì–´ì§€ëŠ” **í”„ë¡œì íŠ¸ ë¼ì´í”„ì‚¬ì´í´ ì „ì²´ë¥¼ ìˆ˜í–‰**í–ˆìŠµë‹ˆë‹¤.

ğŸ”— ê¸°íš ìë£Œ  
- [Figma í™”ë©´ ì„¤ê³„]((https://www.figma.com/design/FYYxvzwGzkNBLJrTOa5ROW/Stay-folio?node-id=0-1&t=ekM1qKT06YyBd0Pw-1))  
- [Google Sheets ë°ì´í„° êµ¬ì¡°/ì¼ì • ê´€ë¦¬]([https://docs.google.com/spreadsheets/...](https://docs.google.com/spreadsheets/d/1OQmVgNTZ_Yc10W1KOM3R84FSjb7fj2WZQVZQrMFWXYk/edit?usp=sharing))

- ê°œë°œ ê¸°ê°„ : 25/07/23 ~ 25/08/20

<br>

---

<br>

## ğŸ¯ í”„ë¡œì íŠ¸ ëª©í‘œ
- **ì‹¤ë¬´ ìˆ˜ì¤€ ì›¹ ì„œë¹„ìŠ¤ êµ¬í˜„**
  - Spring MVC + MyBatis + JSP ê¸°ë°˜ ì•„í‚¤í…ì²˜ ì„¤ê³„ ë° êµ¬í˜„  
  - Controller â€“ Service â€“ Mapper â€“ DB ê³„ì¸µ êµ¬ì¡° í™•ë¦½  
  - Oracle Cloud DB ê¸°ë°˜ ì •ê·œí™”, ì œì•½ì¡°ê±´, ì™¸ë˜í‚¤ë¥¼ ë°˜ì˜í•œ í…Œì´ë¸” ì„¤ê³„  

- **í•µì‹¬ ê¸°ëŠ¥ ì œê³µ**

  **ğŸ‘‘ ê´€ë¦¬ì(Admin)**
  - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ (ì˜ˆì•½ í†µê³„, ìˆ™ì†Œ í†µê³„, ë² ìŠ¤íŠ¸ ìˆ™ì†Œ TOP5)  
  - ìˆ™ì†Œ/ê°ì‹¤ ë“±ë¡ Â· ìˆ˜ì • Â· ì‚­ì œ (ìˆ™ì†Œ ì •ë³´, ê°ì‹¤ ì´ë¯¸ì§€, í¸ì˜ì‹œì„¤/ì–´ë©”ë‹ˆí‹° ê´€ë¦¬)  

  **ğŸ™‹ ì‚¬ìš©ì(User)**
  - ìˆ™ì†Œ ê²€ìƒ‰ ë° ìƒì„¸ í˜ì´ì§€ (ì§€ì—­, ì¶”ì²œ, ë‚ ì§œ, ì¸ì› í•„í„° ì ìš©)  
  - ì˜ˆì•½ ê¸°ëŠ¥ (ì²´í¬ì¸/ì²´í¬ì•„ì›ƒ, ì¸ì› ê¸°ë°˜ ê°€ìš© ì—¬ë¶€ í™•ì¸, ê²°ì œ ëª¨ë“ˆ ì—°ë™)  
  - ë§ˆì´í˜ì´ì§€ (íšŒì› ì •ë³´ ìˆ˜ì •, ì˜ˆì•½ ë‚´ì—­/ì·¨ì†Œ ë‚´ì—­, ë¶ë§ˆí¬ ê´€ë¦¬)   

- **ë³´ì•ˆ ë° ì¸ì¦**
  - Spring Security ê¸°ë°˜ íšŒì›/ê´€ë¦¬ì ê¶Œí•œ ë¶„ë¦¬  
  - ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” (BCrypt), ì„¸ì…˜/Principal ì¸ì¦ ê´€ë¦¬  

- **í´ë¼ìš°ë“œ ë° ì¸í”„ë¼ í™œìš©**
  - Oracle Cloud Walletì„ í†µí•œ ë³´ì•ˆ DB ì—°ê²°  
  - AWS S3 ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° IAM ê¶Œí•œ ì„¤ì •  
  - ì‹¤ì œ ë°°í¬ í™˜ê²½ì„ ê³ ë ¤í•œ ìŠ¤í† ë¦¬ì§€ ì•„í‚¤í…ì²˜ êµ¬ì¶•  

- **UX/UI ê°œì„ **
  - StayFolio ìŠ¤íƒ€ì¼ ë²¤ì¹˜ë§ˆí‚¹ â†’ ì‹¬í”Œí•˜ê³  ê°ê°ì ì¸ í™”ë©´ ë””ìì¸  
  - Kakao Map API ì—°ë™ â†’ ìˆ™ì†Œ ìœ„ì¹˜ í‘œì‹œ  
  - ë°˜ì‘í˜• ì›¹ ì ìš© (ë°ìŠ¤í¬íƒ‘/ëª¨ë°”ì¼ ìµœì í™”)  

- **í˜‘ì—… ë° ê´€ë¦¬**
  - GitHub ë¸Œëœì¹˜ ì „ëµ ê¸°ë°˜ í˜‘ì—…, ì½”ë“œ ë¦¬ë·°, ë³‘í•© ê´€ë¦¬  
  - ì—­í•  ë¶„ë‹´ì„ í†µí•œ DBÂ·ë°±ì—”ë“œÂ·í”„ë¡ íŠ¸Â·í´ë¼ìš°ë“œ ì „ ì˜ì—­ ê²½í—˜  
  - ë¡œê·¸ ë¶„ì„Â·ë””ë²„ê¹…Â·ë¦¬íŒ©í† ë§ì„ í†µí•œ ì‹¤ë¬´ ìˆ˜ì¤€ ë¬¸ì œ í•´ê²° ì—­ëŸ‰ ê°•í™”  

<br>

---

<br>

## ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ

- **Backend**: `Java`, `Spring MVC (Legacy)`, `MyBatis`  
- **Frontend**: `JSP`, `HTML5`, `CSS3`, `JavaScript (jQuery)`, `Figma`(ê¸°íš/UI ì„¤ê³„)  
- **Database**: `Oracle Cloud DB` (SQL, ì‹œí€€ìŠ¤, ì œì•½ì¡°ê±´, ì •ê·œí™”), `Google Sheets`(ERD/ë°ì´í„° êµ¬ì¡° ì„¤ê³„)  
- **Infra/Cloud**: `AWS S3` (ì´ë¯¸ì§€ ì—…ë¡œë“œ, IAM ê¶Œí•œ), `Oracle Wallet`  
- **Security**: `Spring Security`, `BCryptPasswordEncoder`  
- **Tools**: `GitHub`, `SourceTree`, `STS`, `Google Sheets`, `Figma`

<br>

---

<br>

## ğŸ‘¾ í”„ë¡œì íŠ¸ ì„¤ê³„, êµ¬í˜„ 

- ğŸ“‚ Figma ì„¤ê³„ : <[https://www.figma.com/...](https://www.figma.com/design/FYYxvzwGzkNBLJrTOa5ROW/Stay-folio?node-id=0-1&t=ekM1qKT06YyBd0Pw-1)>

- ğŸ“‚ Google Sheets ê¸°íš : <[https://docs.google.com/...](https://docs.google.com/spreadsheets/d/1OQmVgNTZ_Yc10W1KOM3R84FSjb7fj2WZQVZQrMFWXYk/edit?usp=sharing)>

- ğŸ“‚ Team Github : <https://github.com/Spring-team-Project2025/stay_folio_main>

- ğŸ“‚ Diagram : <https://spring-team-project2025.github.io/stay_folio_documents/>

<p align="center">
  <img src="https://github.com/user-attachments/assets/b951c5d6-dfa7-4a2c-840f-069e02060ee5" width="600" alt="ìŠ¬ë¼ì´ë“œ1" />
</p>

<p align="center">
  <img src="https://github.com/user-attachments/assets/dc3a3e57-7673-4770-8fc4-055623678e84" width="600" alt="ë‹¤ì´ì–´ê·¸ë¨" />
</p>

<br>

---

<br>

## ğŸ’» í•µì‹¬ ê¸°ëŠ¥

### ğŸ‘‘ ê´€ë¦¬ì(Admin)

#### 1ï¸âƒ£ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ
> **ì˜ˆì•½ í†µê³„, ìˆ™ì†Œ í†µê³„, ë² ìŠ¤íŠ¸ ìˆ™ì†Œ TOP5 ì œê³µ**  
ê´€ë¦¬ìê°€ ì „ì²´ í˜„í™©ì„ í•œëˆˆì— íŒŒì•…í•  ìˆ˜ ìˆëŠ” ëŒ€ì‹œë³´ë“œ í™”ë©´ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

<p align="center"> <img src="https://github.com/user-attachments/assets/62bc8c27-e34e-47fb-91ad-6def4bf40224" width="700" alt="ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ í™”ë©´" /> </p>

<br>

#### 2ï¸âƒ£ ìˆ™ì†Œ/ê°ì‹¤ ì´ë¯¸ì§€ ì—…ë¡œë“œ (AWS S3 ì—°ë™)

| ì´ë¯¸ì§€ ë“±ë¡ í™”ë©´ | ì´ë¯¸ì§€ ë“±ë¡ ì™„ë£Œ í™”ë©´ |
|----------------|------------------|
| <img src="https://github.com/user-attachments/assets/3b7fa887-b9b6-48c7-9bae-3bc2adae8576" width="400"/> | <img src="https://github.com/user-attachments/assets/4c1ec916-65ab-47b4-b872-cd8a08c51729" width="400"/> |


> **ìˆ™ì†Œ/ê°ì‹¤ ì´ë¯¸ì§€ ì—…ë¡œë“œÂ·ìˆ˜ì •**ì„ AWS S3ì— ì €ì¥í•˜ê³ , ì—…ë¡œë“œëœ ê²½ë¡œë¥¼ DBì— ë°˜ì˜í•©ë‹ˆë‹¤.  
> ì—…ë¡œë“œ í‚¤ëŠ” `stay/{siId}/{riId?}/{UUID}` ê·œì¹™ìœ¼ë¡œ ê´€ë¦¬ë˜ì–´ ì¶©ëŒ ì—†ì´ ì•ˆì „í•˜ê²Œ ì €ì¥ë©ë‹ˆë‹¤.

<br>

##### ğŸ” ë™ì‘ íë¦„

```mermaid
sequenceDiagram
    autonumber
    participant Admin as Admin(ì›¹)
    participant Controller as UploadController
    participant Service as S3Uploader
    participant S3 as AWS S3
    participant DB as Oracle DB

    Admin->>Controller: POST /admin/stay/imageUpload<br/>or /admin/room/imageUpload
    Controller->>Service: uploadStayPhoto(...)<br/>uploadRoomPhoto(...)
    Service->>S3: PutObject(bucket, key, fileStream, metadata)
    Service->>DB: INSERT or UPDATE photo record
    Controller-->>Admin: "success"
```
##### ğŸ“Œ ì„¤ëª…

- `Admin(ì›¹)` : ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì´ë¯¸ì§€ ì„ íƒ í›„ ì—…ë¡œë“œ ìš”ì²­ ì „ì†¡

- `UploadController` : ì—…ë¡œë“œ ìš”ì²­ì„ ë°›ì•„ `S3Uploader` ì„œë¹„ìŠ¤ì— ì „ë‹¬

- `S3Uploader(Service)` : S3ì— ì‹¤ì œ ì—…ë¡œë“œ ìˆ˜í–‰ í›„ DB ë°˜ì˜

- `AWS S3` : ì´ë¯¸ì§€ íŒŒì¼ ì €ì¥ì†Œ **(UUID ê¸°ë°˜ í‚¤ ê´€ë¦¬)**

- `Oracle DB` : ì—…ë¡œë“œëœ íŒŒì¼ ê²½ë¡œ(sp_url)ë¥¼ í…Œì´ë¸”ì— INSERT/UPDATE

<br>

##### ğŸ§± í•µì‹¬ ì½”ë“œ

###### ğŸŒ AWS ì—°ê²° ì„¤ì •
```java
// AwsConfig.java
@Configuration
@PropertySource("classpath:application.properties")
public class AwsConfig {
    //S3ì™€ í†µì‹ í•˜ê¸° ìœ„í•œ AmazonS3 Beanì„ ìƒì„±

    @Value("${cloud.aws.credentials.access-key}") private String accessKey;
    @Value("${cloud.aws.credentials.secret-key}") private String secretKey;
    @Value("${cloud.aws.region.static}") private String region;

    @Bean
    public AmazonS3 amazonS3() {
        // AWS ì¸ì¦ ì •ë³´ ìƒì„±
        BasicAWSCredentials credentials = new BasicAWSCredentials(accessKey, secretKey);

        // AmazonS3 í´ë¼ì´ì–¸íŠ¸ ìƒì„± ë° ë°˜í™˜
        return AmazonS3ClientBuilder.standard()
            .withRegion(Regions.fromName(region))
            .withCredentials(new AWSStaticCredentialsProvider(credentials))
            .build();
    }
}
```

##### ğŸ“Œ ì„¤ëª…

- AWS S3 ì ‘ê·¼ì„ ìœ„í•œ _AmazonS3 Bean_ ë“±ë¡
- application.propertiesì— ì €ì¥ëœ ì•¡ì„¸ìŠ¤ í‚¤ / ì‹œí¬ë¦¿ í‚¤ / ë¦¬ì „ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì™€ ì¸ì¦

#### (1) ì—…ë¡œë“œ (ë“±ë¡)
```java
// UploadController.java
@PostMapping("/stay/imageUpload")
public String uploadStayImages(@RequestParam("siId") int siId,
      @RequestParam(value = "riId", required = false) Integer riId,
			@RequestParam("imageFiles") List<MultipartFile> imageFiles,
      @RequestParam("spIdxes") List<Integer> spIdxes) throws IOException {

    for (int i = 0; i < imageFiles.size(); i++) {
			MultipartFile file = imageFiles.get(i);
			int spIdx = spIdxes.get(i);

			if (!file.isEmpty()) {
				s3Uploader.uploadStayPhoto(siId, riId, spIdx, file);
			}
		}
    return "success";
}
```

##### ğŸ“Œ ì„¤ëª…

- ë‹¤ì¤‘ íŒŒì¼ ì—…ë¡œë“œë¥¼ ì²˜ë¦¬í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬
- S3Uploader ì„œë¹„ìŠ¤ì— ì—…ë¡œë“œ ì‘ì—… ìœ„ì„

<br>

```java
// S3Uploader.java (ë“±ë¡)
public void uploadStayPhoto(int siId, Integer riId, int spIdx, MultipartFile file) throws IOException {
    String fileName = "stay/" + siId + "/" + UUID.randomUUID();

    ObjectMetadata metadata = new ObjectMetadata();
	metadata.setContentType(file.getContentType());
	metadata.setContentDisposition("inline");
	metadata.setContentLength(file.getSize());

    PutObjectRequest request = new PutObjectRequest(bucket, fileName, file.getInputStream(), metadata);
	amazonS3.putObject(request); // S3ì— ì—…ë¡œë“œ

    PhotoVO photo = new PhotoVO();
	photo.setSiId(siId);
	photo.setRiId(riId);
	photo.setSpIdx(spIdx);
	photo.setSpUrl(fileName);

	stayMapper.insertStayPhoto(photo);
}
```
##### ğŸ“Œ ì„¤ëª…

- UUIDë¥¼ ì‚¬ìš©í•´ íŒŒì¼ëª…ì„ ê³ ìœ í•˜ê²Œ ìƒì„±
- S3ì— ì—…ë¡œë“œ í›„, íŒŒì¼ ê²½ë¡œ(sp_url)ë¥¼ DBì— INSERT

<br>

```java
<!-- StayMapper.xml -->
<insert id="insertStayPhoto" parameterType="com.hotel.domain.PhotoVO">
  INSERT INTO t_stay_photo (si_id, ri_id, sp_idx, sp_url)
  VALUES (#{siId}, #{riId, jdbcType=NULL}, #{spIdx}, #{spUrl})
</insert>
```

##### ğŸ“Œ ì„¤ëª…

- ì—…ë¡œë“œëœ ì´ë¯¸ì§€ ì •ë³´ë¥¼ t_stay_photo í…Œì´ë¸”ì— ì €ì¥

<br>

#### (2) ì—…ë¡œë“œ (ìˆ˜ì •)
```java
// S3Uploader.java (ìˆ˜ì •)
public void updateStayImage(int siId, Integer riId, int spIdx, MultipartFile file) throws IOException {
    String key = "stay/" + siId + "/" + UUID.randomUUID();

    ObjectMetadata meta = new ObjectMetadata();
    meta.setContentType(file.getContentType());
    meta.setContentLength(file.getSize());

    amazonS3.putObject(new PutObjectRequest(bucket, key, file.getInputStream(), meta));

    PhotoVO photo = new PhotoVO();
    photo.setSiId(siId); photo.setRiId(riId);
    photo.setSpIdx(spIdx); photo.setSpUrl(key);

    if (stayMapper.existsStayPhoto(photo)) {
        stayMapper.updateStayPhoto(photo); // UPDATE
    } else {
        stayMapper.insertStayPhoto(photo); // INSERT
    }
}
```
##### ğŸ“Œ ì„¤ëª…

- ê¸°ì¡´ spIdx ìœ„ì¹˜ì— ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ UPDATE
- ì—†ìœ¼ë©´ ìƒˆ ë ˆì½”ë“œë¥¼ INSERT

<br>

```java
<!-- StayMapper.xml -->
<select id="existsStayPhoto" parameterType="com.hotel.domain.PhotoVO" resultType="boolean">
  SELECT CASE WHEN COUNT(*) > 0 THEN 1 ELSE 0 END
  FROM t_stay_photo
  WHERE si_id = #{siId} AND sp_idx = #{spIdx}
    <choose>
      <when test="riId == null">AND ri_id IS NULL</when>
      <otherwise>AND ri_id = #{riId}</otherwise>
    </choose>
</select>

<update id="updateStayPhoto" parameterType="com.hotel.domain.PhotoVO">
  UPDATE t_stay_photo
  SET sp_url = #{spUrl}
  WHERE si_id = #{siId} AND sp_idx = #{spIdx}
    <choose>
      <when test="riId == null">AND ri_id IS NULL</when>
      <otherwise>AND ri_id = #{riId}</otherwise>
    </choose>
</update>
```

##### ğŸ“Œ ì„¤ëª…

- existsStayPhotoë¡œ ì´ë¯¸ì§€ ì¡´ì¬ ì—¬ë¶€ ì²´í¬
- ìˆìœ¼ë©´ updateStayPhoto, ì—†ìœ¼ë©´ insertStayPhoto ìˆ˜í–‰

<br>

---

<br>

## ğŸ–¼ ì£¼ìš” ê¸°ëŠ¥ ì‹¤í–‰í™”ë©´


