# STAYPOLIO ìŠ¤íƒ€ì¼ ìˆ™ì†Œ ì‚¬ì´íŠ¸ ì›¹êµ¬í˜„ í”„ë¡œì íŠ¸

<p align="center">
  <img width="800" alt="ë©”ì¸í™”ë©´" src="https://github.com/user-attachments/assets/caba1a57-4232-479f-b5cd-48f96938d591" />
</p>


---

<br>

## ëª©ì°¨

- [ê°œìš”]()

- [ê¸°ìˆ  ìŠ¤íƒ]()

- [í”„ë¡œì íŠ¸ ì„¤ê³„](https://github.com/Spring-team-Project2025/stay_folio_main)

- [í•µì‹¬ ê¸°ëŠ¥]()

- [ì£¼ìš”ê¸°ëŠ¥ ì‹¤í–‰í™”ë©´]()

<br>

---

<br>

## ğŸ“Œ í”„ë¡œì íŠ¸ ê°œìš”

StayFolio ìŠ¤íƒ€ì¼ì˜ **ìˆ™ë°• ì˜ˆì•½ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜**ìœ¼ë¡œ,
**Spring MVC (ë ˆê±°ì‹œ), MyBatis, JSP** ê¸°ë°˜ìœ¼ë¡œ ê°œë°œë˜ì—ˆìœ¼ë©° **Oracle Cloud DBì™€ AWS S3ë¥¼ ì—°ë™**í–ˆìŠµë‹ˆë‹¤.
ìˆ™ì†Œ ê²€ìƒ‰ë¶€í„° ì˜ˆì•½Â·ê²°ì œê¹Œì§€ ì‹¤ì œ ì„œë¹„ìŠ¤ ê°€ëŠ¥í•œ ìˆ˜ì¤€ì˜ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í–ˆìŠµë‹ˆë‹¤.

ë˜í•œ **Figma, Google Sheetsë¥¼ í™œìš©í•´ ì´ˆê¸° ê¸°íš ë‹¨ê³„ë¶€í„° í™”ë©´ ì„¤ê³„, ë°ì´í„° êµ¬ì¡° ì •ì˜, ì¼ì • ê´€ë¦¬**ê¹Œì§€ ì „ ê³¼ì •ì„ ê²½í—˜í•˜ë©°  
ê¸°íš â†’ ì„¤ê³„ â†’ ê°œë°œ â†’ í…ŒìŠ¤íŠ¸ â†’ ë°°í¬ë¡œ ì´ì–´ì§€ëŠ” **í”„ë¡œì íŠ¸ ë¼ì´í”„ì‚¬ì´í´ ì „ì²´ë¥¼ ìˆ˜í–‰**í–ˆìŠµë‹ˆë‹¤.

ğŸ”— ê¸°íš ìë£Œ  
- [Figma í™”ë©´ ì„¤ê³„](https://www.figma.com/design/FYYxvzwGzkNBLJrTOa5ROW/Stay-folio?node-id=0-1&t=ekM1qKT06YyBd0Pw-1)  
- [Google Sheets ë°ì´í„° êµ¬ì¡°/ì¼ì • ê´€ë¦¬](https://docs.google.com/spreadsheets/d/1OQmVgNTZ_Yc10W1KOM3R84FSjb7fj2WZQVZQrMFWXYk/edit?usp=sharing)

- ê°œë°œ ê¸°ê°„ : 25/07/23 ~ 25/08/20

<br>

---

<br>

## ğŸ¯ í”„ë¡œì íŠ¸ ëª©í‘œ
- **ì‹¤ë¬´ ìˆ˜ì¤€ ì›¹ ì„œë¹„ìŠ¤ êµ¬í˜„**
  - Spring MVC + MyBatis + JSP ê¸°ë°˜ ì•„í‚¤í…ì²˜ ì„¤ê³„ ë° êµ¬í˜„  
  - Controller â€“ Service â€“ Mapper â€“ DB ê³„ì¸µ êµ¬ì¡° í™•ë¦½  
  - Oracle Cloud DB ê¸°ë°˜ ì •ê·œí™”, ì œì•½ì¡°ê±´, ì™¸ë˜í‚¤ë¥¼ ë°˜ì˜í•œ í…Œì´ë¸” ì„¤ê³„  

- **í•µì‹¬ ê¸°ëŠ¥ ì œê³µ**

  **ğŸ‘‘ ê´€ë¦¬ì(Admin)**
  - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ (ì˜ˆì•½ í†µê³„, ìˆ™ì†Œ í†µê³„, ë² ìŠ¤íŠ¸ ìˆ™ì†Œ TOP5)  
  - ìˆ™ì†Œ/ê°ì‹¤ ë“±ë¡ Â· ìˆ˜ì • Â· ì‚­ì œ (ìˆ™ì†Œ ì •ë³´, ê°ì‹¤ ì´ë¯¸ì§€, í¸ì˜ì‹œì„¤/ì–´ë©”ë‹ˆí‹° ê´€ë¦¬)
  - íšŒì› ì¡°íšŒ Â· ê´€ë¦¬
  - ì˜ˆì•½ ì¡°íšŒ Â· ê´€ë¦¬

  **ğŸ™‹ ì‚¬ìš©ì(User)**
  - ìˆ™ì†Œ ê²€ìƒ‰ ë° ìƒì„¸ í˜ì´ì§€ (ì§€ì—­, ì¶”ì²œ, ë‚ ì§œ, ì¸ì› í•„í„° ì ìš©)  
  - ì˜ˆì•½ ê¸°ëŠ¥ (ì²´í¬ì¸/ì²´í¬ì•„ì›ƒ, ì¸ì› ê¸°ë°˜ ê°€ìš© ì—¬ë¶€ í™•ì¸, ê²°ì œ ëª¨ë“ˆ ì—°ë™)
  - íšŒì›ê°€ì…/ë¡œê·¸ì¸ (Spring Security)
  - ë§ˆì´í˜ì´ì§€ (íšŒì› ì •ë³´ ìˆ˜ì •, ì˜ˆì•½ ë‚´ì—­/ì·¨ì†Œ ë‚´ì—­, ë¶ë§ˆí¬ ê´€ë¦¬)   

- **ë³´ì•ˆ ë° ì¸ì¦**
  - Spring Security ê¸°ë°˜ íšŒì›/ê´€ë¦¬ì ê¶Œí•œ ë¶„ë¦¬  
  - ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” (BCrypt), ì„¸ì…˜/Principal ì¸ì¦ ê´€ë¦¬  

- **í´ë¼ìš°ë“œ ë° ì¸í”„ë¼ í™œìš©**
  - Oracle Cloud Walletì„ í†µí•œ ë³´ì•ˆ DB ì—°ê²°  
  - AWS S3 ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° IAM ê¶Œí•œ ì„¤ì •  
  - ì‹¤ì œ ë°°í¬ í™˜ê²½ì„ ê³ ë ¤í•œ ìŠ¤í† ë¦¬ì§€ ì•„í‚¤í…ì²˜ êµ¬ì¶•  

- **UX/UI ê°œì„ **
  - StayFolio ìŠ¤íƒ€ì¼ ë²¤ì¹˜ë§ˆí‚¹ â†’ ì‹¬í”Œí•˜ê³  ê°ê°ì ì¸ í™”ë©´ ë””ìì¸  
  - Kakao Map API ì—°ë™ â†’ ìˆ™ì†Œ ìœ„ì¹˜ í‘œì‹œ  
  - ë°˜ì‘í˜• ì›¹ ì ìš© (ë°ìŠ¤í¬íƒ‘/ëª¨ë°”ì¼ ìµœì í™”)  

- **í˜‘ì—… ë° ê´€ë¦¬**
  - GitHub ë¸Œëœì¹˜ ì „ëµ ê¸°ë°˜ í˜‘ì—…, ì½”ë“œ ë¦¬ë·°, ë³‘í•© ê´€ë¦¬  
  - ì—­í•  ë¶„ë‹´ì„ í†µí•œ DBÂ·ë°±ì—”ë“œÂ·í”„ë¡ íŠ¸Â·í´ë¼ìš°ë“œ ì „ ì˜ì—­ ê²½í—˜  
  - ë¡œê·¸ ë¶„ì„Â·ë””ë²„ê¹…Â·ë¦¬íŒ©í† ë§ì„ í†µí•œ ì‹¤ë¬´ ìˆ˜ì¤€ ë¬¸ì œ í•´ê²° ì—­ëŸ‰ ê°•í™”  

<br>

---

<br>

## ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ

- **Backend**: `Java`, `Spring MVC (Legacy)`, `MyBatis`  
- **Frontend**: `JSP`, `HTML5`, `CSS3`, `JavaScript (jQuery)`, `Figma`(ê¸°íš/UI ì„¤ê³„)  
- **Database**: `Oracle Cloud DB` (SQL, ì‹œí€€ìŠ¤, ì œì•½ì¡°ê±´, ì •ê·œí™”), `Google Sheets`(ERD/ë°ì´í„° êµ¬ì¡° ì„¤ê³„)  
- **Infra/Cloud**: `AWS S3` (ì´ë¯¸ì§€ ì—…ë¡œë“œ, IAM ê¶Œí•œ), `Oracle Wallet`  
- **Security**: `Spring Security`, `BCryptPasswordEncoder`  
- **Tools**: `GitHub`, `SourceTree`, `STS`, `Google Sheets`, `Figma`

<br>

---

<br>

## ğŸ‘¾ í”„ë¡œì íŠ¸ ì„¤ê³„, êµ¬í˜„ 

- ğŸ“‚ Figma ì„¤ê³„ : <[https://www.figma.com/...](https://www.figma.com/design/FYYxvzwGzkNBLJrTOa5ROW/Stay-folio?node-id=0-1&t=ekM1qKT06YyBd0Pw-1)>

- ğŸ“‚ Google Sheets ê¸°íš : <[https://docs.google.com/...](https://docs.google.com/spreadsheets/d/1OQmVgNTZ_Yc10W1KOM3R84FSjb7fj2WZQVZQrMFWXYk/edit?usp=sharing)>

- ğŸ“‚ Team Github : <https://github.com/Spring-team-Project2025/stay_folio_main>

- ğŸ“‚ Diagram : <https://spring-team-project2025.github.io/stay_folio_documents/>

<p align="center">
  <img src="https://github.com/user-attachments/assets/b951c5d6-dfa7-4a2c-840f-069e02060ee5" width="600" alt="ìŠ¬ë¼ì´ë“œ1" />
</p>

<p align="center">
  <img src="https://github.com/user-attachments/assets/dc3a3e57-7673-4770-8fc4-055623678e84" width="600" alt="ë‹¤ì´ì–´ê·¸ë¨" />
</p>

<br>

---

<br>

## ğŸ’» í•µì‹¬ ê¸°ëŠ¥

### ğŸ‘‘ ê´€ë¦¬ì(Admin)

### 1ï¸âƒ£ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ (Chart.js ì‹œê°í™”)
> **ì˜ˆì•½/íšŒì›/ì§€ì—­ ì§€í‘œë¥¼ ì„œë²„ì—ì„œ ì§‘ê³„í•´ JSPì—ì„œ Chart.jsë¡œ ì‹œê°í™”**

<p align="center"> <img src="https://github.com/user-attachments/assets/62bc8c27-e34e-47fb-91ad-6def4bf40224" width="700" alt="ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ í™”ë©´" /> </p>

https://github.com/user-attachments/assets/0f5893e5-7e0a-46d0-963d-b936e676c879

- ê´€ë¦¬ìê°€ ì „ì²´ í˜„í™©ì„ í•œëˆˆì— íŒŒì•…í•  ìˆ˜ ìˆëŠ” ëŒ€ì‹œë³´ë“œ í™”ë©´ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ ì„œë²„ì—ì„œ í†µê³„ë¥¼ ì§‘ê³„í•œ í›„ JSPì—ì„œ Chart.jsë¡œ ì‹œê°í™”í–ˆìŠµë‹ˆë‹¤.
- ì„œë²„ì—ì„œ ê°€ê³µí•œ í†µê³„ë¥¼ JSPì—ì„œ JSTLë¡œ ì•ˆì „í•˜ê²Œ ì¶œë ¥í•˜ì—¬ ì°¨íŠ¸ë¥¼ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.
- ì§‘ê³„ ì§€í‘œ: ì´ ì˜ˆì•½ / ì§„í–‰ / ì™„ë£Œ / ì·¨ì†Œ  
- íšŒì› vs ë¹„íšŒì› ì˜ˆì•½ ë¹„ìœ¨  
- ì§€ì—­ë³„ ìˆ™ì†Œ ë“±ë¡ í˜„í™©  

##### ğŸ§± í•µì‹¬ ì½”ë“œ

###### ğŸ§© Controller (ìš”ì•½)
```java
// AdminDashController.java
@GetMapping("/dashboard")
public String DashBoard(Model model) {
	// ì˜ˆì•½ í˜„í™© (ì´ ì˜ˆì•½ ê±´ìˆ˜, ì§„í–‰ ì¤‘, ì™„ë£Œ, ì·¨ì†Œ)
	ReservationStatsDTO stats = adminService.getReservationStats();
	// íšŒì›, ë¹„íšŒì› ì˜ˆì•½ ë¹„ìœ¨
	Map<String, Integer> memberRatio = adminService.getMemberVsGuestRatio();
	// ì§€ì—­ ë³„ ìˆ™ì†Œ í˜„í™©
	List<LocationCategoryVO> regionStats = adminService.getStayCountByRegion();

	return "admin/adminDash";
}
```

###### ğŸ“Š adminDash.jsp (ìš”ì•½)
```java
<div class="admin-content"
	style="margin-top: 40px; margin-bottom: 40px">
	<div class="chart-grid">
		<!-- ì˜ˆì•½ í˜„í™© -->
		<div class="chart-box">
			<h2 style="margin-bottom: 16px">ì˜ˆì•½ í˜„í™©</h2>
			<canvas id="reservationChart" width="300" height="280"></canvas>
		</div>
		<!-- ì˜ˆì•½ ë¹„ìœ¨ -->
		<div class="chart-box">
			<h3 style="margin-bottom: 16px">íšŒì› vs ë¹„íšŒì› ì˜ˆì•½ ë¹„ìœ¨</h3>
			<canvas id="memberGuestChart" width="250" height="250"></canvas>
		</div>
		<!-- ì§€ì—­ë³„ ìˆ™ì†Œ ë“±ë¡ -->
		<div class="chart-box">
			<h2 style="margin-bottom: 16px">ì§€ì—­ë³„ ìˆ™ì†Œ ë“±ë¡ í˜„í™©</h2>
			<canvas id="regionChart" width="300" height="280"></canvas>
		</div>
	</div>
</div>
```
<details>
	<summary><b>Script(Chart.js) (ìì„¸íˆ ë³´ê¸°)</b></summary>
	
	<script>
      document.addEventListener("DOMContentLoaded", function () {

        // ì˜ˆì•½ í˜„í™© (null-safe)
        const total = ${stats.totalCount != null ? stats.totalCount : 0};
        const inProgress = ${stats.inProgressCount != null ? stats.inProgressCount : 0};
        const completed = ${stats.completedCount != null ? stats.completedCount : 0};
        const canceled = ${stats.canceledCount != null ? stats.canceledCount : 0};

        new Chart(document.getElementById("reservationChart"), {
          type: "bar",
          data: {
            labels: ["ì´ ì˜ˆì•½", "ì§„í–‰ ì¤‘", "ì™„ë£Œ", "ì·¨ì†Œ"],
            datasets: [{
              label: "ê±´ìˆ˜",
              backgroundColor: ["#bbbbbb", "#888888", "#555555", "#dddddd"],
              data: [total, inProgress, completed, canceled]
            }]
          },
          options: {
            responsive: true,
            title: { display: true, text: "ì˜ˆì•½ í˜„í™© í†µê³„" },
            legend: { display: false },
            scales: {
              yAxes: [{ ticks: { beginAtZero: true, precision: 0 } }]
            }
          }
        });

        // íšŒì›/ë¹„íšŒì›
        const member = ${memberCount != null ? memberCount : 0};
        const guest = ${guestCount != null ? guestCount : 0};

        console.log("member : ", member, "guest : ", guest);

        new Chart(document.getElementById("memberGuestChart"), {
          type: "doughnut",
          data: {
            labels: ["íšŒì›", "ë¹„íšŒì›"],
            datasets: [{
              data: [member, guest],
              backgroundColor: ["#ccc", "#000"]
            }]
          },
          options: {
            responsive: true,
            legend: { position: "bottom" }
          }
        });

        // ì§€ì—­ë³„ ìˆ™ì†Œ
        const regionLabels = [
          <c:forEach var="region" items="${regionStats}" varStatus="loop">
            "${region.lcName}"<c:if test="${!loop.last}">,</c:if>
          </c:forEach>
        ];
        const regionData = [
          <c:forEach var="region" items="${regionStats}" varStatus="loop">
            ${region.count}<c:if test="${!loop.last}">,</c:if>
          </c:forEach>
        ];

        new Chart(document.getElementById("regionChart"), {
          type: "bar",
          data: {
            labels: regionLabels,
            datasets: [{
              label: "ìˆ™ì†Œ ê°œìˆ˜",
              backgroundColor: "#aaaaaa",
              data: regionData
            }]
          },
          options: {
            responsive: true,
            title: { display: true, text: "ì§€ì—­ë³„ ìˆ™ì†Œ ë“±ë¡ í†µê³„" },
            legend: { display: false },
            scales: {
              yAxes: [{ ticks: { beginAtZero: true, precision: 0 } }]
            }
          }
        });

      });
    </script>
</details>

<details> 
	<summary><b>Service & Mapper (ìì„¸íˆ ë³´ê¸°)</b></summary> 

	// AdminServiceImpl.java
 	@Override
	public ReservationStatsDTO getReservationStats() {
    	return adminMapper.getReservationStats();
	}
	@Override
	public int getMemberReservationCount() {
    	return adminMapper.getMemberReservationCount();
	}
	@Override
	public int getGuestReservationCount() {
    	return adminMapper.getGuestReservationCount();
	}
	@Override
	public List<LocationCategoryVO> getRegionStayStats() {
    	return adminMapper.getRegionStayStats();
	}

	// AdminMapper.xml
	<!-- ì˜ˆì•½ í˜„í™© ê·¸ë˜í”„ -->
	<select id="getReservationStats"
		resultType="com.hotel.domain.ReservationStatsDTO">
	<![CDATA[
		SELECT
			COUNT(*) AS totalCount,
			COUNT(CASE WHEN sr_status = 'a' AND sr_checkout > SYSDATE THEN 1 END) AS inProgressCount,
			COUNT(CASE WHEN sr_status = 'a' AND sr_checkout <= SYSDATE THEN 1 END) AS completedCount,
			COUNT(CASE WHEN sr_status = 'c' THEN 1 END) AS canceledCount
		FROM t_stay_reservation
		WHERE sr_status IN ('a', 'c')
	]]>
	</select>

	<!-- íšŒì›, ë¹„íšŒì› ì˜ˆì•½ ë¹„ìœ¨ -->
	<select id="getMemberVsGuestRatio" resultType="map">
		SELECT
		COUNT(CASE
		WHEN mi_id IS NOT NULL THEN 1 END) AS memberCount,
		COUNT(CASE WHEN
		mi_id IS NULL THEN 1 END) AS guestCount
		FROM t_stay_reservation
		WHERE
		sr_status = 'a' -- ì˜ˆì•½ ì™„ë£Œëœ ê±´ë§Œ
	</select>

	<!-- ì§€ì—­ ë³„ ìˆ™ì†Œ í˜„í™© ê·¸ë˜í”„ -->
	<select id="getStayCountByRegion"
		resultType="com.hotel.domain.LocationCategoryVO">
		SELECT
		l.lc_id AS lcId,
		l.lc_name AS lcName,
		COUNT(s.si_id) AS
		count
		FROM
		t_location_category l
		LEFT JOIN
		t_stay_info s ON l.lc_id =
		s.lc_id AND s.si_show = '1'
		GROUP BY
		l.lc_id, l.lc_name
		ORDER BY
		l.lc_id
	</select>
 
 </details>
<br>
<br>

### 2ï¸âƒ£ ìˆ™ì†Œ/ê°ì‹¤ ì´ë¯¸ì§€ ì—…ë¡œë“œ (AWS S3 ì—°ë™)

> **ìˆ™ì†Œ/ê°ì‹¤ ì´ë¯¸ì§€ ì—…ë¡œë“œÂ·ìˆ˜ì •**ì„ AWS S3ì— ì €ì¥í•˜ê³ , ì—…ë¡œë“œëœ ê²½ë¡œë¥¼ DBì— ë°˜ì˜í•©ë‹ˆë‹¤.  
> ì—…ë¡œë“œ í‚¤ëŠ” `stay/{siId}/{riId?}/{UUID}` ê·œì¹™ìœ¼ë¡œ ê´€ë¦¬ë˜ì–´ ì¶©ëŒ ì—†ì´ ì•ˆì „í•˜ê²Œ ì €ì¥ë©ë‹ˆë‹¤.

<p align="center">
  <table>
    <tr>
      <th style="text-align:center;">ì´ë¯¸ì§€ ë“±ë¡ í™”ë©´</th>
      <th style="text-align:center;">ì´ë¯¸ì§€ ë“±ë¡ ì™„ë£Œ í™”ë©´</th>
    </tr>
    <tr>
      <td align="center">
        <img src="https://github.com/user-attachments/assets/3b7fa887-b9b6-48c7-9bae-3bc2adae8576" width="450"/>
      </td>
      <td align="center">
        <img src="https://github.com/user-attachments/assets/4c1ec916-65ab-47b4-b872-cd8a08c51729" width="450"/>
      </td>
    </tr>
  </table>
</p>


<br>

##### ğŸ” ë™ì‘ íë¦„

```mermaid
sequenceDiagram
    autonumber
    participant Admin as Admin(ì›¹)
    participant Controller as UploadController
    participant Service as S3Uploader
    participant S3 as AWS S3
    participant DB as Oracle DB

    Admin->>Controller: POST /admin/stay/imageUpload<br/>or /admin/room/imageUpload
    Controller->>Service: uploadStayPhoto(...)<br/>uploadRoomPhoto(...)
    Service->>S3: PutObject(bucket, key, fileStream, metadata)
    Service->>DB: INSERT or UPDATE photo record
    Controller-->>Admin: "success"
```
##### ğŸ“Œ ì„¤ëª…

- `Admin(ì›¹)` : ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì´ë¯¸ì§€ ì„ íƒ í›„ ì—…ë¡œë“œ ìš”ì²­ ì „ì†¡

- `UploadController` : ì—…ë¡œë“œ ìš”ì²­ì„ ë°›ì•„ `S3Uploader` ì„œë¹„ìŠ¤ì— ì „ë‹¬

- `S3Uploader(Service)` : S3ì— ì‹¤ì œ ì—…ë¡œë“œ ìˆ˜í–‰ í›„ DB ë°˜ì˜

- `AWS S3` : ì´ë¯¸ì§€ íŒŒì¼ ì €ì¥ì†Œ **(UUID ê¸°ë°˜ í‚¤ ê´€ë¦¬)**

- `Oracle DB` : ì—…ë¡œë“œëœ íŒŒì¼ ê²½ë¡œ(sp_url)ë¥¼ í…Œì´ë¸”ì— INSERT/UPDATE

<br>

##### ğŸ§± í•µì‹¬ ì½”ë“œ

###### ğŸŒ AWS ì—°ê²° ì„¤ì •
```java
// AwsConfig.java
@Configuration
@PropertySource("classpath:application.properties")
public class AwsConfig {
    //S3ì™€ í†µì‹ í•˜ê¸° ìœ„í•œ AmazonS3 Beanì„ ìƒì„±

    @Value("${cloud.aws.credentials.access-key}") private String accessKey;
    @Value("${cloud.aws.credentials.secret-key}") private String secretKey;
    @Value("${cloud.aws.region.static}") private String region;

    @Bean
    public AmazonS3 amazonS3() {
        // AWS ì¸ì¦ ì •ë³´ ìƒì„±
        BasicAWSCredentials credentials = new BasicAWSCredentials(accessKey, secretKey);

        // AmazonS3 í´ë¼ì´ì–¸íŠ¸ ìƒì„± ë° ë°˜í™˜
        return AmazonS3ClientBuilder.standard()
            .withRegion(Regions.fromName(region))
            .withCredentials(new AWSStaticCredentialsProvider(credentials))
            .build();
    }
}
```

##### ğŸ“Œ ì„¤ëª…

- AWS S3 ì ‘ê·¼ì„ ìœ„í•œ _AmazonS3 Bean_ ë“±ë¡
- application.propertiesì— ì €ì¥ëœ ì•¡ì„¸ìŠ¤ í‚¤ / ì‹œí¬ë¦¿ í‚¤ / ë¦¬ì „ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì™€ ì¸ì¦
  
<br>


#### (1) ì—…ë¡œë“œ (ë“±ë¡)
###### ğŸ§© Controller (ìš”ì•½)
```java
// UploadController.java
@PostMapping("/stay/imageUpload")
public String uploadStayImages(@RequestParam("siId") int siId,
      @RequestParam(value = "riId", required = false) Integer riId,
			@RequestParam("imageFiles") List<MultipartFile> imageFiles,
      @RequestParam("spIdxes") List<Integer> spIdxes) throws IOException {

    for (int i = 0; i < imageFiles.size(); i++) {
			MultipartFile file = imageFiles.get(i);
			int spIdx = spIdxes.get(i);

			if (!file.isEmpty()) {
				s3Uploader.uploadStayPhoto(siId, riId, spIdx, file);
			}
		}
    return "success";
}
```

##### ğŸ“Œ ì„¤ëª…

- ë‹¤ì¤‘ íŒŒì¼ ì—…ë¡œë“œë¥¼ ì²˜ë¦¬í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬
- S3Uploader ì„œë¹„ìŠ¤ì— ì—…ë¡œë“œ ì‘ì—… ìœ„ì„

<br>

```java
// S3Uploader.java (ë“±ë¡)
public void uploadStayPhoto(int siId, Integer riId, int spIdx, MultipartFile file) throws IOException {
    String fileName = "stay/" + siId + "/" + UUID.randomUUID();

    ObjectMetadata metadata = new ObjectMetadata();
	metadata.setContentType(file.getContentType());
	metadata.setContentDisposition("inline");
	metadata.setContentLength(file.getSize());

    PutObjectRequest request = new PutObjectRequest(bucket, fileName, file.getInputStream(), metadata);
	amazonS3.putObject(request); // S3ì— ì—…ë¡œë“œ

    PhotoVO photo = new PhotoVO();
	photo.setSiId(siId);
	photo.setRiId(riId);
	photo.setSpIdx(spIdx);
	photo.setSpUrl(fileName);

	stayMapper.insertStayPhoto(photo);
}
```
##### ğŸ“Œ ì„¤ëª…

- UUIDë¥¼ ì‚¬ìš©í•´ íŒŒì¼ëª…ì„ ê³ ìœ í•˜ê²Œ ìƒì„±
- S3ì— ì—…ë¡œë“œ í›„, íŒŒì¼ ê²½ë¡œ(sp_url)ë¥¼ DBì— INSERT

<br>

```java
<!-- StayMapper.xml -->
<insert id="insertStayPhoto" parameterType="com.hotel.domain.PhotoVO">
  INSERT INTO t_stay_photo (si_id, ri_id, sp_idx, sp_url)
  VALUES (#{siId}, #{riId, jdbcType=NULL}, #{spIdx}, #{spUrl})
</insert>
```

##### ğŸ“Œ ì„¤ëª…

- ì—…ë¡œë“œëœ ì´ë¯¸ì§€ ì •ë³´ë¥¼ t_stay_photo í…Œì´ë¸”ì— ì €ì¥

<br>

#### (2) ì—…ë¡œë“œ (ìˆ˜ì •)

<p align="center"> <img width="700" alt="ê´€ë¦¬ì ìˆ˜ì •(ì´ë¯¸ì§€) í™”ë©´" src="https://github.com/user-attachments/assets/49fdc548-339f-4a03-afb0-35ff0d1eb418" /> </p>

```java
// S3Uploader.java (ìˆ˜ì •)
public void updateStayImage(int siId, Integer riId, int spIdx, MultipartFile file) throws IOException {
    String key = "stay/" + siId + "/" + UUID.randomUUID();

    ObjectMetadata meta = new ObjectMetadata();
    meta.setContentType(file.getContentType());
    meta.setContentLength(file.getSize());

    amazonS3.putObject(new PutObjectRequest(bucket, key, file.getInputStream(), meta));

    PhotoVO photo = new PhotoVO();
    photo.setSiId(siId); photo.setRiId(riId);
    photo.setSpIdx(spIdx); photo.setSpUrl(key);

    if (stayMapper.existsStayPhoto(photo)) {
        stayMapper.updateStayPhoto(photo); // UPDATE
    } else {
        stayMapper.insertStayPhoto(photo); // INSERT
    }
}
```

<details>
	<summary><b>Service & Mapper (ìì„¸íˆ ë³´ê¸°)</b></summary>

 	// S3Uploader.java
 	// ìˆ™ì†Œ ì´ë¯¸ì§€ ìˆ˜ì •
	public void updateStayImage(int siId, Integer riId, int spIdx, MultipartFile file) throws IOException {
		String fileName = "stay/" + siId + "/" + UUID.randomUUID();
		ObjectMetadata metadata = new ObjectMetadata();
		metadata.setContentType(file.getContentType());
		metadata.setContentDisposition("inline");
		metadata.setContentLength(file.getSize());

		PutObjectRequest request = new PutObjectRequest(bucket, fileName, file.getInputStream(), metadata);
		amazonS3.putObject(request); // S3ì— ì—…ë¡œë“œ

		PhotoVO photo = new PhotoVO();
		photo.setSiId(siId);
		photo.setRiId(riId);
		photo.setSpIdx(spIdx);
		photo.setSpUrl(fileName);

		System.out.println("PhotoVO riId: " + photo.getRiId());

		boolean exists = stayMapper.existsStayPhoto(photo); // ì´ë¯¸ì§€ ì¡´ì¬ ì—¬ë¶€ í™•ì¸

		System.out.println("ì´ë¯¸ì§€ ì¡´ì¬ ì—¬ë¶€: " + stayMapper.existsStayPhoto(photo));

		if (exists) {
			stayMapper.updateStayPhoto(photo); // UPDATE
		} else {
			stayMapper.insertStayPhoto(photo); // ë¹„ì–´ìˆì„ ê²½ìš° INSERT
		}
	}

	// ê°ì‹¤ ì´ë¯¸ì§€ ìˆ˜ì •
	public void updateRoomImage(int siId, int riId, int spIdx, MultipartFile file) throws IOException {
		String fileName = "stay/" + siId + "/" + riId + "/" + UUID.randomUUID();
		ObjectMetadata metadata = new ObjectMetadata();
		metadata.setContentType(file.getContentType());
		metadata.setContentDisposition("inline");
		metadata.setContentLength(file.getSize());

		PutObjectRequest request = new PutObjectRequest(bucket, fileName, file.getInputStream(), metadata);
		amazonS3.putObject(request); // S3ì— ì—…ë¡œë“œ

		RoomPhotoVO photo = new RoomPhotoVO();
		photo.setSiId(siId);
		photo.setRiId(riId);
		photo.setSpIdx(spIdx);
		photo.setSpUrl(fileName);

		boolean exists = roomMapper.existsRoomPhoto(photo); // ì´ë¯¸ì§€ ì¡´ì¬ ì—¬ë¶€ í™•ì¸

		if (exists) {
			roomMapper.updateRoomPhoto(photo); // UPDATE
		} else {
			roomMapper.insertRoomPhoto(photo); // ë¹„ì–´ìˆì„ ê²½ìš° INSERT
		}
	}

 	<!-- StayMapper.xml -->
  	<insert id="insertStayPhoto" parameterType="com.hotel.domain.PhotoVO">
  		INSERT INTO t_stay_photo (si_id, ri_id, sp_idx, sp_url)
  		VALUES (#{siId}, #{riId, jdbcType=NULL}, #{spIdx}, #{spUrl})
	</insert>
	
 	<select id="existsStayPhoto" parameterType="com.hotel.domain.PhotoVO" resultType="boolean">
  		SELECT CASE WHEN COUNT(*) > 0 THEN 1 ELSE 0 END
  		FROM t_stay_photo
  		WHERE si_id = #{siId} AND sp_idx = #{spIdx}
    	<choose>
      		<when test="riId == null">AND ri_id IS NULL</when>
      		<otherwise>AND ri_id = #{riId}</otherwise>
    	</choose>
	</select>

	<update id="updateStayPhoto" parameterType="com.hotel.domain.PhotoVO">
  		UPDATE t_stay_photo
  		SET sp_url = #{spUrl}
  		WHERE si_id = #{siId} AND sp_idx = #{spIdx}
    	<choose>
      		<when test="riId == null">AND ri_id IS NULL</when>
      		<otherwise>AND ri_id = #{riId}</otherwise>
    	</choose>
	</update>
 
</details>

##### ğŸ“Œ ì„¤ëª…

- ê¸°ì¡´ spIdx ìœ„ì¹˜ì— ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ UPDATE
- ì—†ìœ¼ë©´ ìƒˆ ë ˆì½”ë“œë¥¼ INSERT
- existsStayPhotoë¡œ ì´ë¯¸ì§€ ì¡´ì¬ ì—¬ë¶€ ì²´í¬
- ìˆìœ¼ë©´ updateStayPhoto, ì—†ìœ¼ë©´ insertStayPhoto ìˆ˜í–‰


<br>
<br>

### 3ï¸âƒ£ ìˆ™ì†Œ + ê°ì‹¤ ë“±ë¡ (í¼ â†’ ê²€ì¦/ì €ì¥ â†’ ë‹¤ìŒ ë‹¨ê³„)

<p align="center">
  <table>
    <tr>
      <th style="text-align:center;">ìˆ™ì†Œ ë“±ë¡ í™”ë©´</th>
      <th style="text-align:center;">ìˆ™ì†Œ ë“±ë¡ ìš”êµ¬ ëª¨ë‹¬</th>
    </tr>
    <tr>
      <td align="center">
		  <img width="550" alt="admin_stay_add" src="https://github.com/user-attachments/assets/f9cd2943-375e-437e-ae6f-69e1e2263227" />
      </td>
      <td align="center">
		<img width="250" src="https://github.com/user-attachments/assets/a985b053-1582-4e69-aac9-7d72e5569307" />
      </td>
    </tr>
  </table>
</p>

https://github.com/user-attachments/assets/ffee1a38-0baa-4da0-9752-4d8f830fdf26

> **ìˆ™ì†Œ ê¸°ë³¸ì •ë³´/ìƒì„¸/í¸ì˜ì‹œì„¤/í‚¤ì›Œë“œ ë“±ë¡ â†’ ì¦‰ì‹œ ê°ì‹¤ ë“±ë¡ í™”ë©´ìœ¼ë¡œ ì´ë™**  
> í¼ ì œì¶œ í›„ ë§ˆì§€ë§‰ `siId`ë¥¼ ë°”ì¸ë”©í•´ **ì—°ì† ë“±ë¡(ìˆ™ì†Œ â†’ ê°ì‹¤ â†’ ì´ë¯¸ì§€)** íë¦„ì„ ì§€ì›í•©ë‹ˆë‹¤.

<br>

#### ğŸ” ë™ì‘ íë¦„
```mermaid
sequenceDiagram
  autonumber
  participant Admin as Admin(ì›¹)
  participant C as AdminController
  participant S as StayService
  participant R as RoomService
  participant S3 as AWS S3
  participant DB as Oracle DB

  Admin->>C: GET /admin/stay/add (ìˆ™ì†Œ ë“±ë¡ í¼)
  C-->>Admin: stayRegister.jsp (ì§€ì—­/í¸ì˜ì‹œì„¤/í‚¤ì›Œë“œ ì„ íƒ)

  Admin->>C: POST /admin/stay/add (ìˆ™ì†Œ ë“±ë¡)
  C->>S: insertStayInfo(stay, detail, facilities, keywords)
  S->>DB: INSERT t_stay_info / t_stay_info_detail / t_stay_facility_rel / t_stay_recommend
  S-->>C: siId ë°˜í™˜(getLastInsertId)

  C-->>Admin: stayRegister.jsp (newSiId í‘œì‹œ & **ì´ë¯¸ì§€ ì—…ë¡œë“œ ì§„í–‰ ê°€ëŠ¥**)
  Admin->>C: POST /admin/stay/imageUpload (siId, spIdx[], files)
  C->>S3: PutObject (bucket, key, fileStream, metadata)
  C->>DB: INSERT/UPDATE t_stay_photo
  C-->>Admin: "success" (**ì´ë¯¸ì§€ ì—…ë¡œë“œ ì™„ë£Œ** ì•Œë¦¼)

  Admin->>C: GET /admin/rooms?siId={siId} (**ì´ë¯¸ì§€ ì™„ë£Œ í›„ ì´ë™**)
  C-->>Admin: roomRegister.jsp (**ê°ì‹¤ ë“±ë¡ í¼**)
  Admin->>C: POST /admin/stay/rooms/add
  C->>R: insertRoom(vo, facilities, amenities)
  R->>DB: INSERT t_room_info / t_room_facility_rel / t_room_amenity_rel
  C-->>Admin: redirect:/admin/rooms?siId=...&riId=... (ê°ì‹¤ ì´ë¯¸ì§€ ì¶”ê°€ ìˆ™ì†Œì™€ ë™ì¼)
```

##### ğŸ“Œ ì„¤ëª…
- Admin(ì›¹) : ê´€ë¦¬ìì—ì„œ ìˆ™ì†Œ ë“±ë¡ â†’ ì´ë¯¸ì§€ ë“±ë¡ â†’ ê°ì‹¤ ë“±ë¡ê¹Œì§€ ìˆœì°¨ ì§„í–‰

- AdminController : ìˆ™ì†Œ ë“±ë¡ í¼ ì œê³µ, ë“±ë¡ ìš”ì²­ ì²˜ë¦¬, StayService/RoomService í˜¸ì¶œ

- StayService : ìˆ™ì†Œ ê¸°ë³¸ì •ë³´Â·ìƒì„¸Â·í¸ì˜ì‹œì„¤Â·í‚¤ì›Œë“œë¥¼ DBì— ì €ì¥, ë§ˆì§€ë§‰ siId ë°˜í™˜

- AWS S3 : ì—…ë¡œë“œëœ ì´ë¯¸ì§€ íŒŒì¼ ì €ì¥ (key: stay/{siId}/{riId?}/{UUID})

- Oracle DB : t_stay_info, t_stay_detail, t_stay_photo, t_room_info ë“± INSERT/UPDATE

- RoomService : ê°ì‹¤ ì •ë³´ì™€ ì„ íƒëœ í¸ì˜ì‹œì„¤Â·ì–´ë©”ë‹ˆí‹°ë¥¼ DBì— ë“±ë¡

- íë¦„ ì œì•½ : ë°˜ë“œì‹œ ì´ë¯¸ì§€ ë“±ë¡ì„ ì™„ë£Œí•´ì•¼ë§Œ ê°ì‹¤ ë“±ë¡(roomRegister.jsp)ìœ¼ë¡œ ì´ë™ ê°€ëŠ¥

<br>

##### ğŸ§± í•µì‹¬ ì½”ë“œ
###### ğŸ§© Controller (ìš”ì•½)
```java
	// AdminContriller.java
	// ìˆ™ì†Œ ë“±ë¡
	@PostMapping("/stay/add")
	public String addStay(StayVO stay, StayDetailVO detail,
			@RequestParam(value = "facilities", required = false) List<Integer> facilities, @RequestParam(value = "keyword", required = false) List<Integer> keyword, Model model) {

		// ìˆ™ì†Œ ì •ë³´ insert
		stayService.insertStayInfo(stay, detail, facilities, keyword);

		// ìµœê·¼ si_id ê°€ì ¸ì˜¤ê¸°
		int siId = stayService.getLastInsertId();

		if (facilities == null) {
			facilities = new ArrayList<>();
		}

		List<FacilityVO> facilityList = stayService.getAllFacilities();

		model.addAttribute("stay", stay); // ìˆ™ì†Œ ê¸°ë³¸ ì •ë³´
		model.addAttribute("detail", detail); // ìˆ™ì†Œ ìƒì„¸ ì •ë³´
		model.addAttribute("facilityList", facilityList); // ëª¨ë“  í¸ì˜ ì‹œì„¤ ëª©ë¡
		model.addAttribute("selectedFacilityIds", facilities); // ì„ íƒëœ í¸ì˜ ì‹œì„¤
		model.addAttribute("newSiId", siId); // insert ëœ ìˆ™ì†Œ id

		return "/admin/room/stayRegister"; // ê°™ì€ í˜ì´ì§€ë¡œ ëŒì•„ê°€ì„œ ì´ë¯¸ì§€ ë“±ë¡ ì§„í–‰
	}
```
###### ğŸ§© Service (ìš”ì•½)
```java
	// StayServiceImpl.java
	// admin - ìˆ™ì†Œ ë“±ë¡
	@Override
	@Transactional(rollbackFor = Exception.class)
	public void insertStayInfo(StayVO stay, StayDetailVO detail, List<Integer> facilityIds, List<Integer> keyword) {
		// ìˆ™ì†Œ ê¸°ë³¸ ì •ë³´
		stayMapper.insertStayInfo(stay);

		// ë“±ë¡ëœ ìˆ™ì†Œ id
		int siId = stayMapper.getLastInsertId();

		// ìƒì„¸ ì •ë³´ idì— ë“±ë¡ëœ ìˆ™ì†Œ id ì„¤ì •
		detail.setSiId(siId);
		// ìˆ™ì†Œ ìƒì„¸ ì •ë³´ ë“±ë¡
		stayMapper.insertStayDetail(detail);

		// ì„ íƒëœ í¸ì˜ì‹œì„¤ ë“±ë¡
		if (facilityIds != null) {
			for (Integer fiId : facilityIds) {
				stayMapper.insertFacilityRel(siId, fiId);
			}
		}

		// ì„ íƒëœ í‚¤ì›Œë“œ ë“±ë¡
		if (keyword != null) {
			for (Integer rcId : keyword) {
				adminMapper.insertCategoryStay(rcId, siId);
			}
		}
	}
```

<details> 
	<summary><b>Controller (ìì„¸íˆ ë³´ê¸°)</b></summary> 

	@Controller
	@RequestMapping("/admin")
	public class AdminController {

		@Autowired
		private StayService stayService;

		@Autowired
		private RoomService roomService;

		@Autowired
		private AdminService adminService;

		// ìˆ™ì†Œ ë“±ë¡ í˜ì´ì§€
		@GetMapping("/stay/add")
		public String StayForm(Model model) {
			// ì§€ì—­ ì„ íƒ ëª©ë¡
			model.addAttribute("locationList", stayService.getAllLocations());
		
			// í¸ì˜ ì‹œì„¤ ì„ íƒ ëª©ë¡
			model.addAttribute("facilityList", stayService.getAllFacilities());

			// ê²€ìƒ‰ í‚¤ì›Œë“œ ì„ íƒ ëª©ë¡
			model.addAttribute("keywordList", adminService.getRecommendKeyword());

			return "admin/room/stayRegister";
		}

		// ìˆ™ì†Œ ë“±ë¡
		@PostMapping("/stay/add")
		public String addStay(StayVO stay, StayDetailVO detail,
			@RequestParam(value = "facilities", required = false) List<Integer> facilities, @RequestParam(value = "keyword", required = false) List<Integer> keyword, Model model) {

			// ìˆ™ì†Œ ì •ë³´ insert
			stayService.insertStayInfo(stay, detail, facilities, keyword);

			// ìµœê·¼ si_id ê°€ì ¸ì˜¤ê¸°
			int siId = stayService.getLastInsertId();

			if (facilities == null) {
				facilities = new ArrayList<>();
			}

			List<FacilityVO> facilityList = stayService.getAllFacilities();

			model.addAttribute("stay", stay); // ìˆ™ì†Œ ê¸°ë³¸ ì •ë³´
			model.addAttribute("detail", detail); // ìˆ™ì†Œ ìƒì„¸ ì •ë³´
			model.addAttribute("facilityList", facilityList); // ëª¨ë“  í¸ì˜ ì‹œì„¤ ëª©ë¡
			model.addAttribute("selectedFacilityIds", facilities); // ì„ íƒëœ í¸ì˜ ì‹œì„¤
			model.addAttribute("newSiId", siId); // insert ëœ ìˆ™ì†Œ id

			return "/admin/room/stayRegister"; // ê°™ì€ í˜ì´ì§€ë¡œ ëŒì•„ê°€ì„œ ì´ë¯¸ì§€ ë“±ë¡ ì§„í–‰
		}
	

		@GetMapping("/rooms") // ìˆ™ì†Œ ë“±ë¡ì—ì„œ ê°ì‹¤ ë“±ë¡ í˜ì´ì§€ ì´ë™
		public String showRoomRegister(@RequestParam("siId") int siId,
			@RequestParam(value = "riId", required = false) Integer riId, Model model) {
			model.addAttribute("siId", siId);
			model.addAttribute("riId", riId);
			model.addAttribute("facilityList", stayService.getAllFacilities());
			model.addAttribute("amenityList", roomService.getAllAmenities());
		
			// ê°ì‹¤ ë²ˆí˜¸ê°€ ìˆì„ ê²½ìš°
        	if (riId != null) {
            	RoomVO room = roomService.getRoomById(siId, riId);
            	List<FacilityVO> roomFacilities = roomService.getFacilitiesByRoomId(siId, riId);
            	List<AmenityVO> roomAmenities = roomService.getAmenitiesByRoomId(siId, riId);
            
            	// ì„ íƒëœ ì‹œì„¤ë“¤ì˜ fiId, aiIdxë§Œ ì¶”ì¶œ
            	List<Integer> selectedFacilityIds = roomFacilities.stream().map(FacilityVO::getFiId)
                    .collect(Collectors.toList());
            	List<Integer> selectedAmenityIds = roomAmenities.stream().map(AmenityVO::getAiIdx)
                    .collect(Collectors.toList());
            
             	Map<Integer, Boolean> selectedFacilityMap = selectedFacilityIds.stream()
                     .collect(Collectors.toMap(i -> i, i -> true, (a,b)->a));
             	Map<Integer, Boolean> selectedAmenityMap = selectedAmenityIds.stream()
                     .collect(Collectors.toMap(i -> i, i -> true, (a,b)->a));
            
           	 	model.addAttribute("room", room);
            	model.addAttribute("selectedFacilityMap", selectedFacilityMap);
            	model.addAttribute("selectedAmenityMap", selectedAmenityMap);
        	}
		
			return "admin/room/roomRegister";
		}

		@PostMapping("/stay/rooms/add") // ê°ì‹¤ ë“±ë¡
		public String addRoom(RoomVO vo, @RequestParam(value = "facilities", required = false) List<Integer> facilities,
			@RequestParam(value = "amenities", required = false) List<Integer> amenities, RedirectAttributes rttr) {

			int riId = roomService.insertRoom(vo, facilities, amenities);

			// ë“±ë¡ ëœ ê°ì‹¤, ìˆ™ì†Œ ë§ˆì§€ë§‰ id
			rttr.addAttribute("siId", vo.getSiId());
			rttr.addAttribute("riId", riId);

			return "redirect:/admin/rooms";
		}

		// ë“±ë¡ ì™„ë£Œëœ ê°ì‹¤ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
		@GetMapping(value = "/stay/rooms/list", produces = "application/json")
		@ResponseBody
		public List<RoomVO> getRoomList(@RequestParam("siId") int siId) {
			return stayService.getRoomsByStayId(siId);
		}
	}
</details>

<details> 
	<summary><b>ìˆ™ì†Œ ë“±ë¡ Service & Mapper (ìì„¸íˆ ë³´ê¸°)</b></summary> 

 	// StayServiceImpl.java (ë“±ë¡ ë¶€ë¶„ ë°œì·Œ)
	// í¸ì˜ì‹œì„¤ ë¦¬ìŠ¤íŠ¸
	@Override
	public List<FacilityVO> getAllFacilities() {
		return stayMapper.getAllFacilities();
	}

	// admin - ìˆ™ì†Œ ë“±ë¡
	@Override
	@Transactional(rollbackFor = Exception.class)
	public void insertStayInfo(StayVO stay, StayDetailVO detail, List<Integer> facilityIds, List<Integer> keyword) {
		// ìˆ™ì†Œ ê¸°ë³¸ ì •ë³´
		stayMapper.insertStayInfo(stay);

		// ë“±ë¡ëœ ìˆ™ì†Œ id
		int siId = stayMapper.getLastInsertId();

		// ìƒì„¸ ì •ë³´ idì— ë“±ë¡ëœ ìˆ™ì†Œ id ì„¤ì •
		detail.setSiId(siId);
		// ìˆ™ì†Œ ìƒì„¸ ì •ë³´ ë“±ë¡
		stayMapper.insertStayDetail(detail);

		// ì„ íƒëœ í¸ì˜ì‹œì„¤ ë“±ë¡
		if (facilityIds != null) {
			for (Integer fiId : facilityIds) {
				stayMapper.insertFacilityRel(siId, fiId);
			}
		}

		// ì„ íƒëœ í‚¤ì›Œë“œ ë“±ë¡
		if (keyword != null) {
			for (Integer rcId : keyword) {
				adminMapper.insertCategoryStay(rcId, siId);
			}
		}
	}

	// ìˆ™ì†Œ ë§ˆì§€ë§‰ id ì¡°íšŒ
	@Override
	public int getLastInsertId() {
		return stayMapper.getLastInsertId();
	}

	@Override
	public void insertStayDetail(StayDetailVO detail) {
		stayMapper.insertStayDetail(detail);
	}

	@Override
	public void insertFacilityRel(int siId, int fiId) {
		stayMapper.insertFacilityRel(siId, fiId);
	}

	// StayMapper.xml (ë“±ë¡ ë¶€ë¶„ ë°œì·Œ)
 	<!-- admin insert ì‹œì‘ -->
	<!-- ì§€ì—­ ëª©ë¡ ì¡°íšŒ -->
	<select id="getAllLocations"
		resultType="com.hotel.domain.LocationCategoryVO">
		SELECT lc_id AS lcId, lc_name AS lcName, lc_id AS lcId
		FROM
		t_location_category ORDER BY lc_id
	</select>

	<!-- í¸ì˜ì‹œì„¤ ëª©ë¡ ì¡°íšŒ -->
	<select id="getAllFacilities"
		resultType="com.hotel.domain.FacilityVO">
		SELECT fi_id AS fiId, fi_name AS fiName FROM
		t_facility_info ORDER BY fi_id
	</select>

	<!-- ìˆ™ì†Œ ê¸°ë³¸ ì •ë³´ ë“±ë¡ -->
	<insert id="insertStayInfo"
		parameterType="com.hotel.domain.StayVO">
		INSERT INTO t_stay_info (
		si_name, si_desc, si_loca,
		lc_id,
		si_book, si_review, si_minperson, si_maxperson, si_minprice,
		si_extra, si_peak, si_off, si_discount,
		si_show, si_delete, si_date
		)
		VALUES (
		#{siName}, #{siDesc}, #{siLoca}, #{lcId},
		#{siBook},
		#{siReview}, #{siMinperson}, #{siMaxperson}, #{siMinprice},
		#{siExtra}, #{siPeak}, #{siOff}, #{siDiscount},
		#{siShow},
		#{siDelete},
		SYSDATE
		)
	</insert>

	<!-- ê°€ì¥ ìµœê·¼ siId -->
	<select id="getLastInsertId" resultType="int">
		SELECT MAX(si_id) FROM
		t_stay_info
	</select>

	<!-- ìˆ™ì†Œ ìƒì„¸ ì„¤ëª… ë“±ë¡ -->
	<insert id="insertStayDetail"
		parameterType="com.hotel.domain.StayDetailVO">
		INSERT INTO t_stay_info_detail (
		si_id, si_notice,
		si_desc1, si_desc2, si_feat1, si_feat2,
		si_feat_title1, si_feat_title2,
		si_address, si_addrdesc, si_phone, si_email, si_instagram,
		si_bizname,
		si_biznum, si_ceo,
		si_pet, si_parking, si_food, si_checkin, si_checkout
		) VALUES (
		#{siId}, #{siNotice, jdbcType=VARCHAR}, #{siDesc1},
		#{siDesc2}, #{siFeat1}, #{siFeat2},
		#{siFeatTitle1},
		#{siFeatTitle2},
		#{siAddress}, #{siAddrdesc}, #{siPhone},
		#{siEmail}, #{siInstagram},
		#{siBizname}, #{siBiznum}, #{siCeo},
		#{siPet}, #{siParking}, #{siFood},
		#{siCheckin}, #{siCheckout}
		)
	</insert>


	<!-- ìˆ™ì†Œ-í¸ì˜ì‹œì„¤ ë§¤í•‘ ë“±ë¡ -->
	<insert id="insertFacilityRel">
		INSERT INTO t_stay_facility_rel (si_id, fi_id)
		VALUES
		(#{siId}, #{fiId})
	</insert>

	<!-- ì´ë¯¸ì§€ insert -->
	<insert id="insertStayPhoto"
		parameterType="com.hotel.domain.PhotoVO">
		INSERT INTO t_stay_photo (si_id, ri_id, sp_idx, sp_url)
		VALUES (#{siId}, #{riId, jdbcType=NULL}, #{spIdx}, #{spUrl})
	</insert>

	<!-- admin insert ë -->
</details>

<details> 
	<summary><b>ê°ì‹¤ ë“±ë¡ Service & Mapper (ìì„¸íˆ ë³´ê¸°)</b></summary> 

	// RoomServiceImpl.java (ë“±ë¡ ë¶€ë¶„ ë°œì·Œ)
 	// admin - ê°ì‹¤ ë“±ë¡
	@Override
	public int insertRoom(RoomVO vo, List<Integer> facilities, List<Integer> amenities) {
		// ê°ì‹¤ ê¸°ë³¸ ì •ë³´ ë“±ë¡
		roomMapper.insertRoom(vo);

		int riId = vo.getRiId();
		int siId = vo.getSiId();

		// ê°ì‹¤ í¸ì˜ì‹œì„¤ insert
		if (facilities != null) {
			for (Integer fiId : facilities) {
				roomMapper.insertRoomFacility(siId, riId, fiId);
			}
		}

		// ê°ì‹¤ ì–´ë©”ë‹ˆí‹° insert
		if (amenities != null) {
			for (Integer aiIdx : amenities) {
				roomMapper.insertRoomAmenity(siId, riId, aiIdx);
			}
		}

		return riId;
	}

	// RoomMapper.xml (ë“±ë¡ ë¶€ë¶„ ë°œì·Œ)
 	<!-- admin ê°ì‹¤ ë“±ë¡ -->
	<insert id="insertRoom" parameterType="com.hotel.domain.RoomVO">
		<!-- siIdì—ì„œ riId ìµœëŒ€ê°’+1 ì¡°íšŒ -->
		<selectKey keyProperty="riId" resultType="int"
			order="BEFORE">
			SELECT NVL(MAX(ri_id), 0) + 1
			FROM t_room_info
			WHERE si_id =
			#{siId}
		</selectKey>

		INSERT INTO t_room_info (
		si_id, ri_id, ri_type, ri_name, ri_desc,
		ri_person,
		ri_maxperson,
		ri_area, ri_bed, ri_bedcnt,
		ri_price,
		ri_bedroom,
		ri_bathroom, ri_show,
		ri_delete, ri_date
		) VALUES (
		#{siId},
		#{riId}, #{riType},
		#{riName}, #{riDesc},
		#{riPerson},
		#{riMaxperson},
		#{riArea}, #{riBed},
		#{riBedcnt},
		#{riPrice},
		#{riBedroom},
		#{riBathroom}, #{riShow},
		#{riDelete},
		SYSDATE
		)
	</insert>

	<insert id="insertRoomFacility">
		INSERT INTO t_room_facility_rel (si_id, ri_id, fi_id)
		VALUES (#{siId}, #{riId}, #{fiId})
	</insert>

	<insert id="insertRoomAmenity">
		INSERT INTO t_room_amenities (si_id, ri_id, ai_idx)
		VALUES (#{siId}, #{riId}, #{aiIdx, jdbcType=INTEGER})
	</insert>

	<insert id="insertRoomPhoto"
		parameterType="com.hotel.domain.RoomPhotoVO">
		INSERT INTO t_room_photo (si_id, ri_id, sp_idx, sp_url)
		VALUES (#{siId}, #{riId}, #{spIdx}, #{spUrl})
	</insert>
</details>

##### ğŸ“Œ ì„¤ëª…

- ì—°ì† ë“±ë¡ UX: ìˆ™ì†Œ ë“±ë¡ ì§í›„ siIdë¥¼ ìœ ì§€í•´ ê°ì‹¤/ì´ë¯¸ì§€ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ì´ë™
- ìˆ˜ì • ì§„ì… ë³µì›: riIdê°€ ìˆìœ¼ë©´ ì„ íƒëœ í¸ì˜ì‹œì„¤/ì–´ë©”ë‹ˆí‹° ì²´í¬ ìƒíƒœ ë³µì›
- ê´€ê³„ í…Œì´ë¸” ë¶„ë¦¬: ì‹œì„¤/ì–´ë©”ë‹ˆí‹°ëŠ” ë§¤í•‘ í…Œì´ë¸”ì— ë³„ë„ INSERT

##### ğŸ“ í™”ë©´/UX í¬ì¸íŠ¸

- ìˆ™ì†Œ ë“±ë¡ í¼: ì§€ì—­/í¸ì˜ì‹œì„¤/í‚¤ì›Œë“œ ì„ íƒ â†’ ì €ì¥
- ì €ì¥ ì§í›„: ê°™ì€ í™”ë©´ì—ì„œ newSiId ë…¸ì¶œ â†’ ê°ì‹¤ ë“±ë¡/ì´ë¯¸ì§€ ì—…ë¡œë“œë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ê°
- ê°ì‹¤ ë“±ë¡ í¼: ê°ì‹¤ ìœ í˜•/ìˆ˜ìš©ì¸ì›/ì¹¨ëŒ€/ê°€ê²© + í¸ì˜ì‹œì„¤/ì–´ë©”ë‹ˆí‹° ë‹¤ì¤‘ ì„ íƒ
- ë“±ë¡ í›„ ë¦¬ë””ë ‰íŠ¸: siId,riIdë¥¼ ì¿¼ë¦¬ë¡œ ë„˜ê²¨ ì´ë¯¸ì§€ ì—…ë¡œë“œ/ì¶”ê°€ ê°ì‹¤ ë“±ë¡ ë°”ë¡œ ì§„í–‰

<br>
<br>

### 4ï¸âƒ£ ìˆ™ì†Œ + ê°ì‹¤ ìˆ˜ì • (ì •ë³´ Â· í¸ì˜ì‹œì„¤/ì–´ë©”ë‹ˆí‹° Â· ì´ë¯¸ì§€)

<p align="center">
  <table>
    <tr>
      <th style="text-align:center;">ìˆ™ì†Œ ìˆ˜ì • í™”ë©´</th>
      <th style="text-align:center;">ê°ì‹¤ ìˆ˜ì • í™”ë©´</th>
    </tr>
    <tr>
      <td align="center">
		  <img width="450" alt="localhost_8082_admin_stay_form_siId=258_1" src="https://github.com/user-attachments/assets/0f3227a4-dde8-4a0c-be6d-93a8fb2efaf1" />
		  <img width="450" alt="localhost_8082_admin_stay_form_siId=258_2" src="https://github.com/user-attachments/assets/36e9c77c-9608-4e30-b6f0-5a421f3cac0e" />
      </td>
      <td align="center">
		<img width="450" alt="localhost_8082_admin_rooms_form_siId=258 riId=1_1" src="https://github.com/user-attachments/assets/fbc085bd-9af7-48da-a98e-1ede19437bd6" />
		<img width="450" alt="localhost_8082_admin_rooms_form_siId=258 riId=1_2" src="https://github.com/user-attachments/assets/847cb401-68dd-4d24-ace1-3ac5f712c41b" />
      </td>
    </tr>
  </table>
</p>

> ìˆ™ì†Œì™€ ê°ì‹¤ì˜ ê¸°ë³¸/ìƒì„¸ ì •ë³´, í¸ì˜ì‹œì„¤, í‚¤ì›Œë“œ, ì´ë¯¸ì§€ê¹Œì§€ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
> ê¸°ì¡´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ ìˆ˜ì • í›„ ì €ì¥í•˜ë©°, í¸ì˜ì‹œì„¤Â·í‚¤ì›Œë“œÂ·ì–´ë©”ë‹ˆí‹°ëŠ” **ì‚­ì œ í›„ ì¬ì‚½ì…(Reset ë°©ì‹)**ìœ¼ë¡œ ë™ê¸°í™”í•©ë‹ˆë‹¤.

<br>

#### ğŸ” ë™ì‘ íë¦„ â€” ìˆ™ì†Œ/ê°ì‹¤ ì´ë¯¸ì§€ ìˆ˜ì • (S3)
```mermaid
sequenceDiagram
  autonumber
  participant Admin as Admin(ì›¹)
  participant C as StayUpdateController
  participant S as StayService
  participant DB as Oracle DB

  Admin->>C: GET /admin/stay/update?siId={siId}
  C-->>Admin: stayUpdate.jsp (ê¸°ì¡´ ìˆ™ì†Œ/ìƒì„¸/í¸ì˜ì‹œì„¤/í‚¤ì›Œë“œ ë°”ì¸ë”©)

  Admin->>C: POST /admin/stay/update (ìˆ˜ì • ì œì¶œ)
  C->>S: updateStay(stay), updateStayDetail(detail)
  C->>S: updateStayFacilities(siId, facilities)
  C->>S: updateStayKeywords(siId, keywords)
  S->>DB: UPDATE t_stay_info / t_stay_info_detail
  S->>DB: DELETE+INSERT t_stay_facility_rel / t_stay_recommend
  C-->>Admin: redirect:/admin/stay/detail?siId=...
```
##### ğŸ“Œ ì„¤ëª…

- ê¸°ì¡´ ì •ë³´ ì¡°íšŒ í›„ ìˆ˜ì • í¼ì— ë°”ì¸ë”©

- ì €ì¥ ì‹œ ê¸°ë³¸/ìƒì„¸ ì •ë³´ëŠ” UPDATE, ì‹œì„¤Â·í‚¤ì›Œë“œ ê´€ê³„ëŠ” ì „ì²´ ì‚­ì œ í›„ ì¬ì‚½ì…

- íŠ¸ëœì­ì…˜ ì ìš©ìœ¼ë¡œ ì‹¤íŒ¨ ì‹œ ë¡¤ë°±

<br>

#### ğŸ” ë™ì‘ íë¦„ â€” ìˆ™ì†Œ/ê°ì‹¤ ì´ë¯¸ì§€ ìˆ˜ì • (S3)
```mermaid
sequenceDiagram
  autonumber
  participant Admin as Admin(ì›¹)
  participant C as UploadController
  participant U as S3Uploader
  participant S3 as AWS S3
  participant DB as Oracle DB

  Admin->>C: POST /admin/stay/imageUpdate (siId, spIdx, file)
  C->>U: updateStayImage(siId, riId?, spIdx, file)
  U->>S3: PutObject(bucket, key=stay/{siId}/{riId?}/{UUID})
  U->>DB: EXISTS? t_stay_photo / t_room_photo
  U->>DB: UPDATE or INSERT sp_url
  C-->>Admin: "success"
```
##### ğŸ“Œ ì„¤ëª…

- ì´ë¯¸ì§€ í‚¤ ê·œì¹™: stay/{siId}/{riId?}/{UUID}

- ë™ì¼ ìœ„ì¹˜(spIdx, siId, riId?)ì— ìˆìœ¼ë©´ UPDATE, ì—†ìœ¼ë©´ INSERT

- DBì˜ sp_url ê°±ì‹ 

<br>

#### ğŸ” ë™ì‘ íë¦„ â€” ê°ì‹¤ ìˆ˜ì •
```mermaid
sequenceDiagram
  autonumber
  participant Admin as Admin(ì›¹)
  participant C as RoomUpdateController
  participant R as RoomService
  participant DB as Oracle DB

  Admin->>C: GET /admin/room/update?siId={siId}&riId={riId}
  C-->>Admin: roomUpdate.jsp (ê¸°ì¡´ ê°ì‹¤/ì‹œì„¤/ì–´ë©”ë‹ˆí‹° ë°”ì¸ë”©)

  Admin->>C: POST /admin/room/update (ìˆ˜ì • ì œì¶œ)
  C->>R: updateRoom(vo, facilities, amenities)
  R->>DB: UPDATE t_room_info
  R->>DB: DELETE+INSERT t_room_facility_rel / t_room_amenities
  C-->>Admin: redirect:/admin/rooms?siId=...&riId=...
```
##### ğŸ“Œ ì„¤ëª…

- ê°ì‹¤ ê¸°ë³¸ì •ë³´ëŠ” UPDATE

- ì‹œì„¤/ì–´ë©”ë‹ˆí‹°ëŠ” RESET ë°©ì‹(ì‚­ì œ í›„ ì¬ì‚½ì…)

- ìˆ˜ì • í¼ì€ ë“±ë¡ JSPì™€ ë™ì¼ í˜ì´ì§€ë¥¼ ì¬ì‚¬ìš©

<br>

##### ğŸ§± í•µì‹¬ ì½”ë“œ

###### ğŸ§©ìˆ™ì†Œ ìˆ˜ì • â€” StayServiceImpl.java (ìš”ì•½)
```java
	// admin - ìˆ™ì†Œ ê¸°ë³¸ ì •ë³´ ìˆ˜ì •
	@Override
	public void updateStay(StayVO stay) {
		stayMapper.updateStay(stay);
	}

	// admin - ìˆ™ì†Œ ìƒì„¸ ì •ë³´ ìˆ˜ì •
	@Override
	public void updateStayDetail(StayDetailVO detail) {
		stayMapper.updateStayDetail(detail);
	}

	// admin - ìˆ™ì†Œ í¸ì˜ ì‹œì„¤ ìˆ˜ì •
	@Override
	public void updateStayFacilities(int siId, List<Integer> facilityIds) {
		// nullì´ë©´ skip, ì„ íƒ ì „ë¶€ í•´ì§€í–ˆì„ ê²½ìš°
		if (facilityIds == null || facilityIds.isEmpty()) {
			System.out.println("â— ì‹œì„¤ ì„ íƒ ì—†ìŒ");
			stayMapper.deleteFacilitiesByStayId(siId); // ê¸°ì¡´ ê²ƒë§Œ ì‚­ì œ
			return;
		}

		// ë¨¼ì € ê¸°ì¡´ ë°ì´í„° ì‚­ì œ
		stayMapper.deleteFacilitiesByStayId(siId);

		// ë‹¤ì‹œ insert
		for (Integer fiId : facilityIds) {
			stayMapper.insertFacilityRel(siId, fiId);
		}
	}
```

<details> 
	<summary><b>ìˆ™ì†Œ ìˆ˜ì • Controller (ìì„¸íˆ ë³´ê¸°)</b></summary> 

	// StayUpdateController.java (ë°œì·Œ)
 	// ìˆ™ì†Œ ìˆ˜ì • í˜ì´ì§€
	@GetMapping("/form")
	public String showUpdateForm(@RequestParam("siId") int siId, Model model) {
		StayVO stay = stayService.getStayInfo(siId);
		StayDetailVO stayDetail = stayService.getStayDetail(siId);
		List<FacilityVO> allFacilities = stayService.getAllFacilities();
		List<FacilityVO> checkedFacilities = stayService.getFacilitiesByStayId(siId); // ì„ íƒëœ ê²ƒ

		Map<Integer, PhotoVO> photoMap = stayService.getAllStayPhotos(siId).stream()
				.collect(Collectors.toMap(PhotoVO::getSpIdx, photo -> photo, (oldVal, newVal) -> oldVal));

		// ì„ íƒëœ ì‹œì„¤ë“¤ì˜ fiIdë§Œ ì¶”ì¶œ
		List<Integer> selectedFacilityIds = checkedFacilities.stream().map(FacilityVO::getFiId)
				.collect(Collectors.toList());
		
		// í‚¤ì›Œë“œ
		var allKeyword = stayService.getAllKeywords();
	    var selectedKeywordIds = stayService.getKeywordIdsByStayId(siId);

		model.addAttribute("stay", stay);
		model.addAttribute("detail", stayDetail);
		model.addAttribute("locationList", stayService.getAllLocations());
		model.addAttribute("allFacilities", allFacilities);
		model.addAttribute("selectedFacilityIds", selectedFacilityIds);
		model.addAttribute("allKeyword", allKeyword);
	    model.addAttribute("selectedKeywordIds", selectedKeywordIds);
		model.addAttribute("photoMap", photoMap);
		return "admin/room/stayUpdateForm";
	}

	// ìˆ™ì†Œ ìˆ˜ì •
	@PostMapping("/update")
	public String updateStay(@ModelAttribute StayVO stay, @ModelAttribute StayDetailVO detail,
			@RequestParam(value = "facilityIds", required = false) List<Integer> facilityIds,
			@RequestParam(value = "keywordIds", required = false) List<Integer> keywordIds,
			@RequestParam Map<String, MultipartFile> fileMap, RedirectAttributes rttr) throws IOException {

		// ê¸°ë³¸ ìˆ™ì†Œ ì •ë³´
		stayService.updateStay(stay);

		// ìƒì„¸ ì •ë³´
		detail.setSiId(stay.getSiId());
		stayService.updateStayDetail(detail);

		// í¸ì˜ì‹œì„¤
		stayService.updateStayFacilities(stay.getSiId(), facilityIds);
		
		// í‚¤ì›Œë“œ
	    stayService.updateStayKeywords(stay.getSiId(), keywordIds);

		// ì´ë¯¸ì§€ íŒŒì¼ ì²˜ë¦¬
		for (Map.Entry<String, MultipartFile> entry : fileMap.entrySet()) {
			String key = entry.getKey();
			if (key.startsWith("replaceImage_")) {
				int spIdx = Integer.parseInt(key.replace("replaceImage_", ""));
				MultipartFile file = entry.getValue();
				if (!file.isEmpty()) {
					s3Uploader.updateStayImage(stay.getSiId(), null, spIdx, file);
				}
			}
		}
		
		// ìˆ™ì†Œ id ë°˜í™˜
		rttr.addAttribute("siId", stay.getSiId());
		
		return "redirect:/admin/stay/detail";
	}
 	
</details>

<details> 
	<summary><b>ìˆ™ì†Œ ìˆ˜ì • Service & Mapper (ìì„¸íˆ ë³´ê¸°)</b></summary> 

	// StayServiceImpl.java (ë°œì·Œ)
 	// admin - ìˆ™ì†Œ ê¸°ë³¸ ì •ë³´ ìˆ˜ì •
	@Override
	public void updateStay(StayVO stay) {
		stayMapper.updateStay(stay);
	}

	// admin - ìˆ™ì†Œ ìƒì„¸ ì •ë³´ ìˆ˜ì •
	@Override
	public void updateStayDetail(StayDetailVO detail) {
		stayMapper.updateStayDetail(detail);
	}

	// admin - ìˆ™ì†Œ í¸ì˜ ì‹œì„¤ ìˆ˜ì •
	@Override
	public void updateStayFacilities(int siId, List<Integer> facilityIds) {
		// nullì´ë©´ skip, ì„ íƒ ì „ë¶€ í•´ì§€í–ˆì„ ê²½ìš°
		if (facilityIds == null || facilityIds.isEmpty()) {
			System.out.println("â— ì‹œì„¤ ì„ íƒ ì—†ìŒ");
			stayMapper.deleteFacilitiesByStayId(siId); // ê¸°ì¡´ ê²ƒë§Œ ì‚­ì œ
			return;
		}

		// ë¨¼ì € ê¸°ì¡´ ë°ì´í„° ì‚­ì œ
		stayMapper.deleteFacilitiesByStayId(siId);

		// ë‹¤ì‹œ insert
		for (Integer fiId : facilityIds) {
			stayMapper.insertFacilityRel(siId, fiId);
		}
	}

	// admin ìˆ™ì†Œ ìƒì„¸í˜ì´ì§€ - í‚¤ì›Œë“œ
	@Override
	public List<RecommendCategoryVO> getKeywordByStayId(int siId) {
		return stayMapper.getKeywordByStayId(siId);
	}

	// admin - ìˆ™ì†Œ idë¡œ í‚¤ì›Œë“œ ì¶”ê°€, ì‚­ì œ
	@Override
	public List<RecommendCategoryVO> getAllKeywords() {
		return stayMapper.getAllKeywords();
	}

	// StayMapper.xml (ë°œì·Œ)
 	<update id="updateStay">
		UPDATE t_stay_info
		SET
		si_name = #{siName},
		si_loca =
		#{siLoca},
		si_desc = #{siDesc},
		si_minperson = #{siMinperson},
		si_maxperson = #{siMaxperson},
		si_minprice = #{siMinprice},
		si_extra =
		#{siExtra},
		si_peak = #{siPeak},
		si_off = #{siOff},
		si_discount =
		#{siDiscount},
		si_show = #{siShow}
		WHERE si_id = #{siId}
	</update>

	<update id="updateStayDetail">
		UPDATE t_stay_info_detail
		SET
		si_notice = #{siNotice},
		si_desc1 = #{siDesc1},
		si_desc2 = #{siDesc2},
		si_feat1 = #{siFeat1},
		si_feat2 = #{siFeat2},
		si_address = #{siAddress},
		si_addrdesc =
		#{siAddrdesc},
		si_phone = #{siPhone},
		si_email =
		#{siEmail},
		si_instagram
		= #{siInstagram},
		si_bizname = #{siBizname},
		si_biznum = #{siBiznum},
		si_ceo = #{siCeo},
		si_pet = #{siPet},
		si_parking = #{siParking},
		si_food
		= #{siFood},
		si_checkin =
		#{siCheckin},
		si_checkout = #{siCheckout},
		si_feat_title1 =
		#{siFeatTitle1},
		si_feat_title2 = #{siFeatTitle2}
		WHERE
		si_id = #{siId}
	</update>

	<delete id="deleteFacilitiesByStayId">
		DELETE FROM t_stay_facility_rel WHERE si_id = #{siId}
	</delete>

	<insert id="insertFacility">
		INSERT INTO t_stay_facility_rel (si_id, fi_id)
		VALUES
		(#{siId}, #{fiId})
	</insert>

	<select id="existsStayPhoto" resultType="boolean"
		parameterType="com.hotel.domain.PhotoVO">
		SELECT CASE WHEN COUNT(*) > 0 THEN 1 ELSE 0 END
		FROM t_stay_photo
		WHERE
		si_id = #{siId}
		AND sp_idx = #{spIdx}
		<choose>
			<when test="riId == null">
				AND ri_id IS NULL
			</when>
			<otherwise>
				AND ri_id = #{riId}
			</otherwise>
		</choose>
	</select>


	<update id="updateStayPhoto"
		parameterType="com.hotel.domain.PhotoVO">
		UPDATE t_stay_photo
		SET sp_url = #{spUrl}
		WHERE si_id = #{siId}
		AND
		sp_idx = #{spIdx}
		<choose>
			<when test="riId == null">
				AND ri_id IS NULL
			</when>
			<otherwise>
				AND ri_id = #{riId}
			</otherwise>
		</choose>
	</update>


	<!-- ìˆ™ì†Œ í‚¤ì›Œë“œ ëª©ë¡ ì¡°íšŒ -->
	<select id="getKeywordByStayId"
		resultType="com.hotel.domain.RecommendCategoryVO">
		SELECT re.rc_id AS rcId, re.rc_name AS rcName
		FROM
		t_recommend_category re
		JOIN
		t_stay_recommend sre ON re.rc_id =
		sre.rc_id
		WHERE sre.si_id = #{siId} AND re.rc_name IS NOT NULL
	</select>

	<!-- ì „ì²´ í‚¤ì›Œë“œ(ì¶”ì²œ ì¹´í…Œê³ ë¦¬) -->
	<select id="getAllKeywords"
		resultType="com.hotel.domain.RecommendCategoryVO">
		SELECT rc_id AS rcId, rc_name AS rcName
		FROM t_recommend_category
		WHERE rc_name IS NOT NULL
		ORDER BY rc_name
	</select>

	<!-- ìˆ™ì†Œì— ì´ë¯¸ ì„ íƒëœ í‚¤ì›Œë“œ IDë“¤ -->
	<select id="getKeywordIdsByStayId" parameterType="int"
		resultType="int">
		SELECT rc_id
		FROM t_stay_recommend
		WHERE si_id = #{siId}
	</select>

	<!-- ìˆ™ì†Œì˜ ê¸°ì¡´ í‚¤ì›Œë“œ ê´€ê³„ ì‚­ì œ -->
	<delete id="deleteKeywordsByStayId" parameterType="int">
		DELETE FROM t_stay_recommend
		WHERE si_id = #{siId}
	</delete>

 	<!-- í‚¤ì›Œë“œ ì¶”ê°€ (ë‹¨ê±´) -->
 	<insert id="insertKeywordForStay">
 		INSERT INTO t_stay_recommend (rc_id, si_id)
 		VALUES (#{rcId}, #{siId})
 	</insert>
</details>

##### ğŸ“Œ ì„¤ëª… â€” StayServiceImpl.java

- updateStay, updateStayDetailëŠ” ê°ê° t_stay_info, t_stay_info_detailì„ ì§ì ‘ UPDATEí•´ ê¸°ë³¸/ìƒì„¸ ì •ë³´ë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤.

- updateStayFacilitiesëŠ” ì²´í¬ë°•ìŠ¤ ë™ê¸°í™”ë¥¼ ìœ„í•´ RESET(ì „ì²´ ì‚­ì œ â†’ ì„ íƒê°’ ì¬ì‚½ì…) ì „ëµì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

- ì „ë‹¬ëœ ëª©ë¡ì´ null/ë¹ˆ ë°°ì—´ì´ë©´ ëª¨ë‘ í•´ì œ(DELETEë§Œ ìˆ˜í–‰) ë˜ì–´ UIì™€ DBê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.

- ì¤‘ë³µ/ìœ ì‹¤ì„ ë°©ì§€í•˜ê³  ì¼ê´€ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•œ íŒ¨í„´ì…ë‹ˆë‹¤.

<br>

###### ğŸ§©ê°ì‹¤ ìˆ˜ì • â€” RoomServiceImpl.java (ìš”ì•½)
```java
	@Override
	public void updateRoomFacilities(int siId, int riId, List<Integer> facilityIds) {
		// ì„ íƒ ì „ë¶€ í•´ì§€í–ˆì„ ê²½ìš°
		if (facilityIds == null || facilityIds.isEmpty()) {
			System.out.println("â— ì‹œì„¤ ì„ íƒ ì—†ìŒ");
			roomMapper.deleteFacilitiesByRoomId(siId, riId); // ê¸°ì¡´ ê²ƒë§Œ ì‚­ì œ
			return;
		}

		// ë¨¼ì € ê¸°ì¡´ ë°ì´í„° ì‚­ì œ
		roomMapper.deleteFacilitiesByRoomId(siId, riId);

		// ë‹¤ì‹œ insert
		for (Integer fiId : facilityIds) {
			roomMapper.insertRoomFacility(siId, riId, fiId);
		}

	}
```

##### ğŸ“Œ ì„¤ëª… â€” RoomServiceImpl.java

- ê°ì‹¤ í¸ì˜ì‹œì„¤ë„ ìˆ™ì†Œì™€ ë™ì¼í•˜ê²Œ DELETE â†’ INSERT ë°©ì‹ìœ¼ë¡œ ì™„ì „ ë™ê¸°í™”í•©ë‹ˆë‹¤.

- ëª©ë¡ì´ ì—†ìœ¼ë©´ í•´ë‹¹ ê°ì‹¤ì˜ ê¸°ì¡´ ë§¤í•‘ì„ ì „ë¶€ ì‚­ì œí•´ â€œì „ë¶€ í•´ì œâ€ ìƒíƒœë¥¼ ë°˜ì˜í•©ë‹ˆë‹¤.

- siId + riId ê¸°ì¤€ìœ¼ë¡œ ë§¤í•‘ì„ ì¬êµ¬ì„±í•´ ì¤‘ë³µ/ëˆ„ë½ì„ ì˜ˆë°©í•©ë‹ˆë‹¤.

- ë“±ë¡/ìˆ˜ì • í¼ ì¬ì‚¬ìš© ì‹œì—ë„ ê²°ê³¼ê°€ í•­ìƒ ê²°ì •ì (idempotent) ì´ë¼ ìœ ì§€ë³´ìˆ˜ê°€ ì‰½ìŠµë‹ˆë‹¤.

<br>

###### ğŸ§©ì´ë¯¸ì§€ ìˆ˜ì • - S3Uploader.java (ìš”ì•½)
```java
	// ìˆ™ì†Œ ì´ë¯¸ì§€ ìˆ˜ì •
	public void updateStayImage(int siId, Integer riId, int spIdx, MultipartFile file) throws IOException {
		String fileName = "stay/" + siId + "/" + UUID.randomUUID();
		ObjectMetadata metadata = new ObjectMetadata();
		metadata.setContentType(file.getContentType());
		metadata.setContentDisposition("inline");
		metadata.setContentLength(file.getSize());

		PutObjectRequest request = new PutObjectRequest(bucket, fileName, file.getInputStream(), metadata);
		amazonS3.putObject(request); // S3ì— ì—…ë¡œë“œ

		PhotoVO photo = new PhotoVO();
		photo.setSiId(siId);
		photo.setRiId(riId);
		photo.setSpIdx(spIdx);
		photo.setSpUrl(fileName);

		System.out.println("PhotoVO riId: " + photo.getRiId());

		boolean exists = stayMapper.existsStayPhoto(photo); // ì´ë¯¸ì§€ ì¡´ì¬ ì—¬ë¶€ í™•ì¸

		System.out.println("ì´ë¯¸ì§€ ì¡´ì¬ ì—¬ë¶€: " + stayMapper.existsStayPhoto(photo));

		if (exists) {
			stayMapper.updateStayPhoto(photo); // UPDATE
		} else {
			stayMapper.insertStayPhoto(photo); // ë¹„ì–´ìˆì„ ê²½ìš° INSERT
		}
	}
```

##### ğŸ“Œ ì„¤ëª… â€” S3Uploader.java

- stay/{siId}/{UUID} í‚¤ë¡œ ì—…ë¡œë“œí•˜ì—¬ íŒŒì¼ëª…ì´ ì¶©ëŒ ì—†ì´ ê³ ìœ í•´ì§‘ë‹ˆë‹¤(ë²„ì „ ê´€ë¦¬ ìš©ì´).

- Content-Type/Length ë“±ì„ ObjectMetadataì— ì„¤ì •í•´ ì •ìƒ ë¯¸ë””ì–´ ì‘ë‹µì„ ë³´ì¥í•©ë‹ˆë‹¤.

- ì—…ë¡œë“œ í›„ í•´ë‹¹ ìœ„ì¹˜(siId, spIdx, riId?)ì— ê¸°ì¡´ ë ˆì½”ë“œê°€ ìˆìœ¼ë©´ UPDATE, ì—†ìœ¼ë©´ INSERT ì²˜ë¦¬í•©ë‹ˆë‹¤.

- ê¸°ì¡´ S3 ê°ì²´ëŠ” ì‚­ì œí•˜ì§€ ì•Šìœ¼ë¯€ë¡œ í•„ìš” ì‹œ ì •ë¦¬(batch/TTL) ì •ì±…ì„ ì¶”ê°€í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤.

